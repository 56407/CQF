
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass{article}

    
    
    \usepackage{graphicx} % Used to insert images
    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{color} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    

    
    
    \definecolor{orange}{cmyk}{0,0.4,0.8,0.2}
    \definecolor{darkorange}{rgb}{.71,0.21,0.01}
    \definecolor{darkgreen}{rgb}{.12,.54,.11}
    \definecolor{myteal}{rgb}{.26, .44, .56}
    \definecolor{gray}{gray}{0.45}
    \definecolor{lightgray}{gray}{.95}
    \definecolor{mediumgray}{gray}{.8}
    \definecolor{inputbackground}{rgb}{.95, .95, .85}
    \definecolor{outputbackground}{rgb}{.95, .95, .95}
    \definecolor{traceback}{rgb}{1, .95, .95}
    % ansi colors
    \definecolor{red}{rgb}{.6,0,0}
    \definecolor{green}{rgb}{0,.65,0}
    \definecolor{brown}{rgb}{0.6,0.6,0}
    \definecolor{blue}{rgb}{0,.145,.698}
    \definecolor{purple}{rgb}{.698,.145,.698}
    \definecolor{cyan}{rgb}{0,.698,.698}
    \definecolor{lightgray}{gray}{0.5}
    
    % bright ansi colors
    \definecolor{darkgray}{gray}{0.25}
    \definecolor{lightred}{rgb}{1.0,0.39,0.28}
    \definecolor{lightgreen}{rgb}{0.48,0.99,0.0}
    \definecolor{lightblue}{rgb}{0.53,0.81,0.92}
    \definecolor{lightpurple}{rgb}{0.87,0.63,0.87}
    \definecolor{lightcyan}{rgb}{0.5,1.0,0.83}
    
    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{CVA}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=blue,
      linkcolor=darkorange,
      citecolor=darkgreen,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{CVA calculation for an Interest Rate
Swap}\label{cva-calculation-for-an-interest-rate-swap}

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}37}]:} \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k+kn}{as} \PY{n+nn}{pd}
%         
%         \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k+kn}{as} \PY{n+nn}{sns}
%         \PY{k+kn}{import} \PY{n+nn}{matplotlib.pyplot} \PY{k+kn}{as} \PY{n+nn}{plt}
%         \PY{k+kn}{from} \PY{n+nn}{matplotlib.ticker} \PY{k+kn}{import} \PY{n}{FuncFormatter}  \PY{c}{\PYZsh{} to apply percentage formatting to labels}
%         
%         \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
%\end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}123}]:} \PY{k+kn}{import} \PY{n+nn}{matplotlib.pylab} \PY{k+kn}{as} \PY{n+nn}{pylab}
%          \PY{n}{params} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s}{\PYZsq{}}\PY{l+s}{legend.fontsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
%                    \PY{l+s}{\PYZsq{}}\PY{l+s}{figure.figsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{,}
%                   \PY{l+s}{\PYZsq{}}\PY{l+s}{axes.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
%                   \PY{l+s}{\PYZsq{}}\PY{l+s}{axes.titlesize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
%                   \PY{l+s}{\PYZsq{}}\PY{l+s}{xtick.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
%                   \PY{l+s}{\PYZsq{}}\PY{l+s}{ytick.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{\PYZcb{}}
%          \PY{n}{pylab}\PY{o}{.}\PY{n}{rcParams}\PY{o}{.}\PY{n}{update}\PY{p}{(}\PY{n}{params}\PY{p}{)}
%          
%          \PY{c}{\PYZsh{} pylab.rcParams[\PYZsq{}figure.figsize\PYZsq{}] = (20, 10)}
%\end{Verbatim}

    In this report we show how to calculate the Credit Valuation Adjustment
(CVA) taken by Counterparty `A' to the price of an Interest Rate Swap
(IRS) using the credit spreads for Counerparty B.

The inputs for the CVA calculation are:

\begin{itemize}
\tightlist
\item
  Default Probabilities (PDs)
\item
  Forward LIBORs
\item
  Discount Factors (DFs)
\end{itemize}

Below we discuss each of these aspects separately.

Additional assumptions for this calculation are:

\begin{itemize}
\tightlist
\item
  The IRS is assumed to be written on a 6M LIBOR \(L_{6M}\) expiring in
  5Y, hence the payment frequency is \(\tau=0.5\)
\item
  The notional is assumed to be \(N=1\)
\end{itemize}

    \subsection{Default Probabilities}\label{default-probabilities}

The Default Probabilities are implied from Credit Default Swaps (CDS)
spreads using the bootstrapping technique.

    \subsubsection{CDS bootstrapping}\label{cds-bootstrapping}

    The bootstrapping formula used was:

\[
P(T_N) = \frac{ \sum^{N−1}_{n=1} D(0, T_n)
[ LP(T_n−1) − (L+ \Delta t_n S_N) P(T_n)]}
{ D(0, T_N)(L+ \Delta t_n S_N) }
+
\frac{P(T_{N−1})L}
{(L+\Delta t_N S_N)}
\]

where \(P\) is the survival probability, \(L = 1-R\) is the loss
calculated from the recovery rate \(R\), \(\Delta t\) is the payment
frequency, \(S\) is the spread and \(D\) is the discount factor

\begin{itemize}
\tightlist
\item
  The counterparty B in this case was chosen to be an airline company -
  AirFrance (``AIRF'')
\item
  The CDS spreads were taken from Reuters on 27-Jun-2016 and are assumed
  to apply also for the period 31-May-2013 to 31-May-2016, which was
  used to calibrate the HJM model (see below)
\item
  The Recovery Rate is assumed to be 40\%
\item
  Linear interpolation is used to approximate the CDS spreads at the
  half increments for which there wasn't market data available
\item
  For consistency and simplicity, the Discount Factors used were the
  same as those implied from the HJM model after taking their average
  for each tenor (see methodology below)
\item
  The full calculation can be found in the project repository file
  ``\emph{CVA/my CDS Bootstrapping v2.xlsx}''
\end{itemize}

The table below summarises the results for each of the tenors
\([0.0, 1.0, \dots, 5.0]\), with `DF' as the discount factor, `Lambda'
as the hazard rate \(\lambda_i\), `PD' as the default probability
\(PD(T_i, T_{i-1}) = P(T_{i-1}) - P(T_i)\) and `P' as the survival
probability. Note that by definition \(PD\) is over a period, whereas
\(P\) is cumulative.

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}71}]:} \PY{n}{data2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{input.csv}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
%         \PY{n}{out} \PY{o}{=} \PY{n}{data2}\PY{o}{.}\PY{n}{to\PYZus{}string}\PY{p}{(}\PY{n}{formatters}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s}{\PYZsq{}}\PY{l+s}{Lambda}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:,.4}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{,} 
%                                     \PY{l+s}{\PYZsq{}}\PY{l+s}{PD}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:,.4}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{,} 
%                                     \PY{l+s}{\PYZsq{}}\PY{l+s}{P}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:,.4}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}
%                                    \PY{p}{\PYZcb{}}\PY{p}{)}
%         \PY{k}{print}\PY{p}{(}\PY{n}{out}\PY{p}{)}
%\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
CDS        DF  Lambda      PD         P
Tenor                                             
0.0        NaN  1.000000    nan\%    nan\% 100.0000\%
0.5    114.400  0.995835 1.8976\% 0.9443\%  99.0557\%
1.0    133.770  0.990963 2.2197\% 1.2510\%  97.8047\%
1.5    167.180  0.985697 2.7798\% 1.8887\%  95.9161\%
2.0    200.590  0.980105 3.3452\% 2.3875\%  93.5285\%
2.5    233.965  0.974101 3.9174\% 2.8579\%  90.6707\%
3.0    267.340  0.967832 4.4994\% 3.2974\%  87.3732\%
3.5    296.545  0.961232 5.0170\% 3.4776\%  83.8957\%
4.0    325.750  0.954239 5.5471\% 3.7947\%  80.1009\%
4.5    353.200  0.946899 6.0576\% 3.9605\%  76.1405\%
5.0    380.650  0.939187 6.5842\% 4.1914\%  71.9490\%
    \end{Verbatim}

    The figures below show the period default probability
\(PD(T_i, T_{i-1}) = P(T_{i-1})\) and the hazard rates \(\lambda_i\) are
not flat but actually have a term structure, which hence should be
accounted in our CVA. The cumulative distribution for \(P\) shows how
the survival probability decreases with time as expected (and viceversa
for the cumulative \(PD\) since by definition this is equal to
\(1 - P\)).

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}124}]:} \PY{n}{index\PYZus{}interpol} \PY{o}{=} \PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{0.0\PYZhy{}0.5}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{0.5\PYZhy{}1.0}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{1.0\PYZhy{}1.5}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{1.5\PYZhy{}2.0}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{2.0\PYZhy{}2.5}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{2.5\PYZhy{}3.0}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{3.0\PYZhy{}3.5}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{3.5\PYZhy{}4.0}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{4.0\PYZhy{}4.5}\PY{l+s}{\PYZsq{}}\PY{p}{,}
%                            \PY{l+s}{\PYZsq{}}\PY{l+s}{4.5\PYZhy{}5.0}\PY{l+s}{\PYZsq{}}\PY{p}{]}
%          \PY{n}{df} \PY{o}{=}  \PY{n}{data2}\PY{p}{[}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{PD}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{Lambda}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
%          \PY{n}{df}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{index\PYZus{}interpol}
%          \PY{c}{\PYZsh{} ax = df.plot(kind=\PYZsq{}bar\PYZsq{}, width=0.8, alpha=0.5, title=\PYZsq{}Default Probability \PYZbs{}n \PYZdl{}PD(T\PYZus{}i, T\PYZus{}\PYZob{}i\PYZhy{}1\PYZcb{}) = P(T\PYZus{}\PYZob{}i\PYZhy{}1\PYZcb{}) \PYZhy{} P(T\PYZus{}i)\PYZdl{}\PYZsq{})}
%          \PY{n}{ax} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{kind}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{bar}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{width}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{Term Structure}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{c}{\PYZsh{} ax = data2[\PYZsq{}Lambda\PYZsq{}].plot(kind=\PYZsq{}bar\PYZsq{}, width=0.8, alpha=0.5)}
%          \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor range (years)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{ax}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}formatter}\PY{p}{(}\PY{n}{FuncFormatter}\PY{p}{(}\PY{k}{lambda} \PY{n}{y}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:.1}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{)}  \PY{c}{\PYZsh{} applies \PYZpc{} formatting to y labels}
%          \PY{c}{\PYZsh{} ax.set\PYZus{}ylabel(\PYZsq{}PD\PYZsq{})}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_9_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}125}]:} \PY{n}{df} \PY{o}{=}  \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{[}\PY{n}{data2}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{P}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{1}\PY{o}{\PYZhy{}}\PY{n}{data2}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{P}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{keys}\PY{o}{=}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{P}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{PD\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
%          \PY{c}{\PYZsh{} out = df.to\PYZus{}string(formatters=\PYZob{}\PYZsq{}P\PYZsq{}: \PYZsq{}\PYZob{}:,.2\PYZpc{}\PYZcb{}\PYZsq{}.format, }
%          \PY{c}{\PYZsh{}                             \PYZsq{}PD\PYZus{}cum\PYZsq{}: \PYZsq{}\PYZob{}:,.2\PYZpc{}\PYZcb{}\PYZsq{}.format}
%          \PY{c}{\PYZsh{}                            \PYZcb{})}
%          \PY{c}{\PYZsh{} print(out)}
%          
%          \PY{n}{ax} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{marker}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{Cumulative distributions}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{ylim}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mf}{1.1}\PY{p}{)}\PY{p}{)}
%          \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor (years)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{ax}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}formatter}\PY{p}{(}\PY{n}{FuncFormatter}\PY{p}{(}\PY{k}{lambda} \PY{n}{y}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:.0}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{)} 
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_10_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Forward LIBORs}\label{forward-libors}

    The Forward LIBOR was obtained by simulating the forward curves with the
HJM model. However, this had to be calibrated to recent data to give a
more realistic picture of the CVA value. The steps taken are described
in detail below.

    \subsubsection{PCA}\label{pca}

    \paragraph{Dataset}\label{dataset}

    The HJM model requires a set of volatility functions which are estimated
using Principal Component Analysis (PCA) on historical forward rates.

\begin{itemize}
\item
  To calibrate these functions to recent data, the forward rates were
  taken from the Bank of England Bank Liability Curve (BLC) for the
  period 31-May-2013 to 31-May-2016 (worth 3 years or 759 data points).
  The data can be found at:
\item
  \href{http://www.bankofengland.co.uk/statistics/Documents/yieldcurve/ukblc16_mdaily.xlsx}{ukblc16\_mdaily.xlsx}
\item
  \href{http://www.bankofengland.co.uk/statistics/Documents/yieldcurve/ukblc05_mdaily.xlsx}{ukblc05\_mdaily.xlsx}
\item
  Although we only need the short-end of the curve for the CVA
  calculation, we take the full curve to calibrate the HJM model,
  i.e.~up the \(25Y\) tenor. The dataset is hence constructed by taking
  the BLC forward curve short-end data (\emph{``1. fwds,short end''}
  tab) for the tenors \([0.5Y, 1.0Y, 1.5Y, ..., 5Y]\) as it offers a
  better approximation to the short-end, and for the remaining tenors
  \([5.5Y, ..., 25.0Y]\) we use the full approximation (\emph{``2. fwd
  curve''} tab)
\item
  The forward rate for the tenor \(0.08Y\) in \emph{``1. fwds,short
  end''} is used as a a proxy for the spot rate tenor \(0.0Y\), i.e.
  \(r(t) = f(t;t)\)
\item
  Dates with missing data values were removed
\item
  The resulting dataset is found in the project reporsitory under
  ``CVA/PCA/my\_ukblc\_310513\_310516.xlsx'' and this was pasted into
  the ``data'' tab of ``\emph{HJM Model - PCA.XLSM}'' to run the PCA
\end{itemize}

    The figure below shows the forward curve for four sample dates spanning
different years in the dataset. This shows how the curve can move for
each of the tenors, for example, at the long-end of the curve the rates
have decreased substantially in 2016 compared to 3 years ago. At the
short-end of the curve we see the rates tend to increase with tenor as
expected.

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}132}]:} \PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{PCA/my HJM Model \PYZhy{} PCA.xlsm}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{sheetname}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{Data}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
%\end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}133}]:} \PY{c}{\PYZsh{} \PYZus{} = df.iloc[0, :].plot(figsize=(20, 10), label=\PYZdq{}1st row\PYZdq{})}
%          \PY{c}{\PYZsh{} \PYZus{} = df.iloc[379, :].plot(figsize=(20, 10), label=\PYZdq{}380th row\PYZdq{})}
%          \PY{c}{\PYZsh{} \PYZus{} = df.iloc[749, :].plot(figsize=(20, 10), label=\PYZdq{}750th row\PYZdq{})}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{31\PYZhy{}May2013}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{Historical Forward Rates}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{l+m+mi}{252}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{30\PYZhy{}May\PYZhy{}2014}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{l+m+mi}{504}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{29\PYZhy{}May\PYZhy{}2015}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{l+m+mi}{758}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{31\PYZhy{}May\PYZhy{}2016}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{upper left}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor (years)}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_18_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The figure below shows the historical evolution of the rate in the
dataset for 3 example tenors. The \(0.08Y\) tenor is a proxy for the
spot rate. This shows the spot rate has remained pretty constant
throughout. The rate increases for the shorter tenors but then decreases
for the longer tenors - so is the case for 25Y vs 10Y below. This could
be interpreted as a lack of liquidity for the longer tenors.

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}146}]:} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{0.08}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{spot}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{1.0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{1Y}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{2.5}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{2Y}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{4.0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{4Y}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{10.0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{10Y}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+m+mf}{25.0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{25Y}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Time (31\PYZhy{}May\PYZhy{}2013 to 31\PYZhy{}May\PYZhy{}2016)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_20_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Principal Components}\label{principal-components}

    To obtain the volatility functions for the HJM model, the day-on-day
changes (differences) for each tenor are calculated. This produces a set
of independent random variables that can be used to get principal
components (PC), taken as the 3 largest eigenvalues and corresponding
eigenvectors which explain 97.5\% of the observed variance. The
calculation details can be found in the project repository under
``\emph{PCA/my HJM Model - PCA.XLSM} The results are summarised below:

\begin{longtable}[c]{@{}llll@{}}
\toprule
& Tenor & Eigenvalue & Cum. R\^{}2\tabularnewline
\midrule
\endhead
1st largest PC & 10.0 & 0.0076790 & 0.9107\tabularnewline
2nd largest PC & 3.0 & 0.0004034 & 0.9586\tabularnewline
3rd largest PC & 6.5 & 0.0001406 & 0.9752\tabularnewline
\bottomrule
\end{longtable}

The figure below shows the resulting eigenvectors of the principal
components.

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{../PCA/figs/eigenvectors2.PNG}
    \end{center}
    
    We now proceed to use these eigenvectors to obtain the volatility
functions for the HJM model.

    \subsubsection{HJM}\label{hjm}

    \paragraph{Volatility functions}\label{volatility-functions}

    The volatility functions for the HJM model are calculated as: \[
Vol_i = \sqrt{\lambda_i} \space e(i) \space\space\space \forall \space i=1,2,3
\] where \(\lambda_i\) is the eigenvalue and \(e(i)\) the eigenvector.
This is equivalent to one standard deviation move in the \(e(i)\)
direction.

The volatility functions have to then be fitted as we need analytical
functions to carry out the integration to get the drift. In this case,
3rd, 5th and 6th degree polynomials were fitted to guarantee a goodness
of fit of over 97\%. These are shown in the figures below. In
particular, for \(Vol_{1}\) fitting a constant (red line) is not suited
and justifies the need for a polynomial fit (however, this could also
lead to overfitting issues).

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{../PCA/figs/Vol_1.PNG}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{../PCA/figs/Vol_2.PNG}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{../PCA/figs/Vol_3.PNG}
    \end{center}

    \paragraph{Drift}\label{drift}

    The drift function \(\mu(t)\) is obtained by integrating over the
principal components and assuming that volatility is a function of time.

    \paragraph{Monte Carlo}\label{monte-carlo}

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor} }]:} \PY{o}{\PYZpc{}}\PY{k}{run} my\PYZus{}HJM\PYZus{}model.py
%\end{Verbatim}

    The calibrated volatility and drift functions above are then entered
into the HJM model Monte Carlo simulation in ``my\_HJM\_model.py'',
which evolves the whole forward curve according to the SDE: \[
d\bar{f} = \mu (t) dt + \sum_{i=1}^{3} Vol_i \phi_i \sqrt{dt} + \frac{dF}{d\tau} dt
\]

where \(\phi_i\) is a random number drawn from the standard normal
distribution and the last term is the Musiela correction. For brevity
the details of the model are omitted here but additional details of the
MC simulation are outlined below:

\begin{itemize}
\tightlist
\item
  Python 2.7 was used in the python script
\item
  The forward curve was initialised using the the last observed forward
  curve data (last row in the BLC data)
\item
  Time step \(dt = 0.01\)
\item
  Number of simulations \(I = 1,000\)
\item
  The random number generator used is python's numpy standard normal
  random number generator (`np.random.standard\_normal') which draw
  samples from a standard Normal distribution (mean=0, stdev=1)
\item
  The antithetic variance reduction technique has not been used here
\end{itemize}

To obtain an expectation of LIBOR rate in the future
\(L(t; T_i, T_{i+1})\), the forward rate \(f\) is selected from the
corresponding tenor column \(\tau = T_{i+1} - T_i\) of the HJM output,
from the correct simulated time \(t\). This is then converted to LIBOR
using \(L = \frac{1}{\tau}(e^{f\tau}-1)\) where
\(\tau_i=0.5 \space \forall \space i\) is the frequency in this case.

For the IRS in question (written on 6M LIBOR for 5Y), the relevant
simulated rates are:

\begin{longtable}[c]{@{}c@{}}
\toprule
L(t; T\_i, T\_i+1) for 6M IRS\tabularnewline
\midrule
\endhead
L(t; 0, 0.5)\tabularnewline
L(t; 0.5, 1)\tabularnewline
L(t; 1, 1.5)\tabularnewline
L(t; 1.5, 2)\tabularnewline
L(t; 2, 2.5)\tabularnewline
L(t; 2.5, 3)\tabularnewline
L(t; 3, 3.5)\tabularnewline
L(t; 3.5, 4)\tabularnewline
L(t; 4, 4.5)\tabularnewline
L(t; 4.5, 5)\tabularnewline
\bottomrule
\end{longtable}

    The figure below shows a sample of 100 simulations for the above Libor
rates

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}150}]:} \PY{n}{L\PYZus{}plus}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{100}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Forward Libor}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor (years)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}  \PY{c}{\PYZsh{} remove legend}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_35_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Discount Factors}\label{discount-factors}

The DFs are implied from the HJM Forward Libor for each simulation via
the formula:

\[
DF(0, T_{i+1}) = \prod_{i} \frac{1}{1 + \tau_i L(t; T_i, T_{i+1})} 
\]

which is equivalent to `integrating under the curve'. This then gives
1000 simulations of the DF for each tenor. For simplicity, an
expectation across all simulations is taken to get a single value for
\(DF(0, T_{i+1})\). This is then used to obtain the forward-starting
discount factors \(DF(T_i, T_{i+1})\) for the IRS in question, where: \[
DF(T_i, T_{i+1}) = \frac{DF(0, T_{i+1})}{DF(0, T_i)}
\]

and by definition \(DF(T_{i+1}, T_{i+1}) = 1.0\)

\begin{longtable}[c]{@{}cllllllllll@{}}
\toprule
\begin{minipage}[b]{0.08\columnwidth}\centering\strut
Tenor
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
0.5
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
1.0
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
1.5
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
2.0
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
2.5
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
3.0
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
3.5
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
4.0
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
4.5
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
5.0
\strut\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
0.5
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(0.5, 0.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(0.5, 1)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(0.5, 1.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(0.5, 2)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(0.5, 2.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(0.5, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(0.5, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(0.5, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(0.5, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(0.5, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
1.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1, 1)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1, 1.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1, 2)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1, 2.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
1.5
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1.5, 1.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1.5, 2)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1.5, 2.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1.5, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1.5, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1.5, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(1.5, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(1.5, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
2.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2, 2)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2, 2.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
2.5
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2.5, 2.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2.5, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2.5, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2.5, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(2.5, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(2.5, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
3.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(3, 3)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(3, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(3, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(3, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(3, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
3.5
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(3.5, 3.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(3.5, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(3.5, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(3.5, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
4.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(4, 4)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(4, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(4, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
4.5
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
DF(4.5, 4.5)
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(4.5, 5)
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.08\columnwidth}\centering\strut
5.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
DF(5, 5)
\strut\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

    The numerical values are shown in the table below:

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}156}]:} \PY{n}{DF2} \PY{o}{=} \PY{n}{DF}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
%          \PY{n}{np}\PY{o}{.}\PY{n}{fill\PYZus{}diagonal}\PY{p}{(}\PY{n}{DF2}\PY{o}{.}\PY{n}{values}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
%          \PY{n}{DF2}
%\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}156}]:}       0.0       0.5       1.0       1.5       2.0       2.5       3.0  \textbackslash{}
          Tenor                                                                   
          0.0     1  0.995835  0.990963  0.985697  0.980105  0.974101  0.967832   
          0.5     0         1  0.995108  0.989819  0.984204  0.978175   0.97188   
          1.0     0         0         1  0.994686  0.989043  0.982984  0.976658   
          1.5     0         0         0         1  0.994327  0.988236  0.981876   
          2.0     0         0         0         0         1  0.993874  0.987478   
          2.5     0         0         0         0         0         1  0.993565   
          3.0     0         0         0         0         0         0         1   
          3.5     0         0         0         0         0         0         0   
          4.0     0         0         0         0         0         0         0   
          4.5     0         0         0         0         0         0         0   
          5.0     0         0         0         0         0         0         0   
          
                      3.5       4.0       4.5       5.0  
          Tenor                                          
          0.0    0.961232  0.954239  0.946899  0.939187  
          0.5    0.965253  0.958231  0.950859  0.943115  
          1.0    0.969998  0.962941  0.955534  0.947752  
          1.5    0.975181  0.968086  0.960639  0.952816  
          2.0    0.980744  0.973609   0.96612  0.958252  
          2.5    0.986789   0.97961  0.972075  0.964158  
          3.0    0.993181  0.985955  0.978371  0.970403  
          3.5           1  0.992725  0.985088  0.977066  
          4.0           0         1  0.992308  0.984226  
          4.5           0         0         1  0.991856  
          5.0           0         0         0         1  
\end{Verbatim}
        
    \subsection{CVA}\label{cva}

    \subsubsection{MTM of the IRS}\label{mtm-of-the-irs}

    The mark-to-market value of the swap \(V(T_i)\) i.e.~the evolution of
swap value over time is obtained via:


\begin{align} 
V(T_i=0)= \sum_{i=1}^{11} N \tau D(0, T_i)(L_i - K) \\
V(T_i=0.5)= \sum_{i=2}^{11} N \tau D(0.5, T_i)(L_i - K) \\
V(T_i=1.0)= \sum_{i=3}^{11} N \tau D(1.0, T_i)(L_i - K) \\
\vdots \space \space \vdots \space \space \vdots \\
V(T_i=5.0)= \sum_{i=11}^{11} N \tau D(5.0, T_i)(L_i - K)
\end{align}

where \(N\) is the notional and \(K\) the fixed agreed rate and
\(L_i = L(t; T_{i-1}, T_{i})\).

Here we assume a par swap by choosing
\(K = L(t; 0, 0.5) \approx 0.0063845\) to have zero initial cashflows
upon entering the swap.

    \subsubsection{Exposure}\label{exposure}

    Finally, the exposure for each tenor \(E_i\) is calculated from the
positive part of the MTM simulations as: \[
E_i = max(V_i, 0)
\]

The figure below shows sample simulations of the exposure profile.

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}164}]:} \PY{n}{E\PYZus{}plus}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{E\PYZus{}plus}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mf}{0.5}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Exposure Profiles}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor (years)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}  \PY{c}{\PYZsh{} remove legend}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_44_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{Expected Exposure}\label{expected-exposure}

    The Expected Exposure (EE) is calculated as the median of the Exposure
profile. The median is here preferred over the mean as the latter can be
skewed by large observations and is more sensitive to outliers.

The figure below shows \(EE_i\) as calculated from the mean and median,
as well as the Potential Future Exposure (PFE) take to be the 97.5
percentile of the \(E_i\) distribution. From this we see that using the
median, the maximum EE and PFE are attained at the beginning of the swap
in this case (equal to \textasciitilde{}5.33\% and
\textasciitilde{}14.89\% of the notional respectively). Clearly the PFE
is always bigger than the EE - in a way this tells us it is 97.5\%
probable that our exposure will not exceed \textasciitilde{}14.89\%.

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}183}]:} \PY{k}{print} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{EE\PYZus{}plus\PYZus{}median}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{100.0}
%          \PY{k}{print} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{PFE\PYZus{}plus}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{100.0}
%\end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%5.33087477088
%14.8923704401
%    \end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}165}]:} \PY{n}{EE\PYZus{}plus\PYZus{}mean}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{EE\PYZus{}mean}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{EE\PYZus{}plus\PYZus{}median}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{EE\PYZus{}median}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{PFE\PYZus{}plus}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{PFE}\PY{l+s}{\PYZdq{}}\PY{p}{)}
%          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
%\end{Verbatim}
%
%            \begin{Verbatim}[commandchars=\\\{\}]
%{\color{outcolor}Out[{\color{outcolor}165}]:} <matplotlib.legend.Legend at 0x20b0e048>
%\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_48_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsubsection{CVA}\label{cva}

Lastly, the CVA is approximated by a linear interpolation across the
tenors: \[
CVA \approx \sum_i (1-R)E(\frac{T_{i-1}-T_i}{2}) DF(\frac{T_{i-1}-T_i}{2}) PD(\frac{T_{i-1}-T_i}{2})
\]

The figure below shows each of the components in this equation

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}171}]:} \PY{n}{Loss} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{index\PYZus{}interpol}\PY{p}{,} \PY{n}{data}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{\PYZhy{}}\PY{n}{RR}\PY{p}{)}\PY{p}{)}
%          \PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{[}\PY{n}{Loss}\PY{p}{,} \PY{n}{EE\PYZus{}plus\PYZus{}median\PYZus{}interpol}\PY{p}{,} \PY{n}{DF\PYZus{}interpol}\PY{p}{,} \PY{n}{PD\PYZus{}interpol}\PY{p}{,} \PY{n}{CVA}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
%                         \PY{n}{keys}\PY{o}{=}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{1\PYZhy{}RR}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{EE\PYZus{}interpol}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{DF\PYZus{}interpol}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{PD\PYZus{}bootstr}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{CVA}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{subplots}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{o}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
%          \PY{c}{\PYZsh{} df.plot(subplots=True, kind=\PYZsq{}bar\PYZsq{}, alpha=0.5, width=1.0)}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_50_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The figure below shows the CVA for each tenor range in percentage terms
over the notional value. We see a 'hump'shape telling us the maximum is
found in the 2.5-3.0Y tenor period.

Based on this, the total CVA over the the lifetime of the swap amounts
to \textasciitilde{}0.473\% over the notional. So for example, if the
notional was \$1m, the CVA would amount to \textasciitilde{}\$4,726

%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}191}]:} \PY{n}{ax} \PY{o}{=}\PY{n}{CVA}\PY{o}{.}\PY{n}{plot}\PY{o}{.}\PY{n}{bar}\PY{p}{(}\PY{n}{width}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{CVA}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Tenor period (years)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
%          \PY{n}{ax}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}formatter}\PY{p}{(}\PY{n}{FuncFormatter}\PY{p}{(}\PY{k}{lambda} \PY{n}{y}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZob{}:.2}\PY{l+s}{\PYZpc{}}\PY{l+s}{\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{)}
%\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{CVA_files/CVA_52_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}195}]:} \PY{k}{print} \PY{n+nb}{round}\PY{p}{(}\PY{n}{CVA\PYZus{}total}\PY{o}{*}\PY{l+m+mf}{100.0}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{)}
%\end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%0.4727
%    \end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%{\color{incolor}In [{\color{incolor}196}]:} \PY{k}{print} \PY{n+nb}{round}\PY{p}{(}\PY{n}{CVA\PYZus{}total}\PY{o}{*}\PY{l+m+mf}{1000000.0}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
%\end{Verbatim}
%
%    \begin{Verbatim}[commandchars=\\\{\}]
%4726.73
%    \end{Verbatim}


\section{Summary}

\begin{itemize}
\item Accruals: Not included effect from accruals
\item Errors: Not provided errors in result, such as the MC simulation error, potential overfitting of the volatility 
\item etc...
\end{itemize}

    % Add a bibliography block to the postdoc
    
    
    
    \end{document}


% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass{article}

    
    
    \usepackage{graphicx} % Used to insert images
    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{color} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    

    
    
    \definecolor{orange}{cmyk}{0,0.4,0.8,0.2}
    \definecolor{darkorange}{rgb}{.71,0.21,0.01}
    \definecolor{darkgreen}{rgb}{.12,.54,.11}
    \definecolor{myteal}{rgb}{.26, .44, .56}
    \definecolor{gray}{gray}{0.45}
    \definecolor{lightgray}{gray}{.95}
    \definecolor{mediumgray}{gray}{.8}
    \definecolor{inputbackground}{rgb}{.95, .95, .85}
    \definecolor{outputbackground}{rgb}{.95, .95, .95}
    \definecolor{traceback}{rgb}{1, .95, .95}
    % ansi colors
    \definecolor{red}{rgb}{.6,0,0}
    \definecolor{green}{rgb}{0,.65,0}
    \definecolor{brown}{rgb}{0.6,0.6,0}
    \definecolor{blue}{rgb}{0,.145,.698}
    \definecolor{purple}{rgb}{.698,.145,.698}
    \definecolor{cyan}{rgb}{0,.698,.698}
    \definecolor{lightgray}{gray}{0.5}
    
    % bright ansi colors
    \definecolor{darkgray}{gray}{0.25}
    \definecolor{lightred}{rgb}{1.0,0.39,0.28}
    \definecolor{lightgreen}{rgb}{0.48,0.99,0.0}
    \definecolor{lightblue}{rgb}{0.53,0.81,0.92}
    \definecolor{lightpurple}{rgb}{0.87,0.63,0.87}
    \definecolor{lightcyan}{rgb}{0.5,1.0,0.83}
    
    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Coint\_Brent\_Gasoil\_v2}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=blue,
      linkcolor=darkorange,
      citecolor=darkgreen,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{Introduction}\label{introduction}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k+kn}{import} \PY{n}{datetime}
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k+kn}{as} \PY{n+nn}{pd}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k+kn}{as} \PY{n+nn}{np}
        
        \PY{c}{\PYZsh{} Stats}
        \PY{k+kn}{import} \PY{n+nn}{statsmodels.tsa.stattools} \PY{c}{\PYZsh{} for ADF test and coint function}
        \PY{k+kn}{import} \PY{n+nn}{statsmodels.api} \PY{c}{\PYZsh{} for OLS}
        
        \PY{c}{\PYZsh{} from scipy.stats import norm  \PYZsh{} to fit normal dist to data}
        \PY{c}{\PYZsh{} import matplotlib.mlab as mlab  \PYZsh{} to generate pdfs}
        
        \PY{c}{\PYZsh{} Plotting}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{import} \PY{n+nn}{matplotlib.pyplot} \PY{k+kn}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k+kn}{as} \PY{n+nn}{sns}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib.pylab} \PY{k+kn}{as} \PY{n+nn}{pylab}
        \PY{n}{params} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s}{\PYZsq{}}\PY{l+s}{legend.fontsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
                  \PY{l+s}{\PYZsq{}}\PY{l+s}{figure.figsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{axes.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:} \PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{axes.titlesize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{xtick.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{,}
                 \PY{l+s}{\PYZsq{}}\PY{l+s}{ytick.labelsize}\PY{l+s}{\PYZsq{}}\PY{p}{:}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{\PYZcb{}}
        \PY{n}{pylab}\PY{o}{.}\PY{n}{rcParams}\PY{o}{.}\PY{n}{update}\PY{p}{(}\PY{n}{params}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}206}]:} \PY{o}{\PYZpc{}}\PY{k}{run} analysis.py
\end{Verbatim}

    This report summarises and demonstrates some of the techniques used at
arriving at trading strategies using the concepts of \emph{stationarity}
and \emph{cointegration}. In particular, the focus is on energy
commodities.

\begin{itemize}
\tightlist
\item
  Section 1 provides details for the datasets used throughout the report
\item
  Section 2 introduces the concept of Stationarity in time series, which
  is the key property exploited by cointegration techniques and
  mean-reverting strategies
\item
  Section 3 goes in detail about Cointegration and how to test for it,
  as well as assesing its quality
\item
  Section 4 is then dedicated to the application of these concepts to
  trading strategies and assesing their performance in terms of profit
  and loss
\item
  Finally the Appendix summarises some of the mathematical methods
  involved such as Multivariate Regression models (VAR(p), ECM,
  Augmented Dickey-Fuller Test and Ornstein--Uhlenbeck processes
\end{itemize}

    \section{Datasets}\label{datasets}

    \subsection{Simulated Data}\label{simulated-data}

Unless otherwise stated, stochastic processes are simulated with Monte
Carlo (MC) where random samples are drawn from the normal distribution.

    \subsection{Real Data}\label{real-data}

    \begin{itemize}
\tightlist
\item
  For simplicity, only two finacial series are used to demonstrate the
  concepts. As the focus is on energy commodities, Brent crude and a
  byproduct (Low Sulphur Gasoil) were selected since they were assumed
  to be good candidates for cointegration given their deep economic link
\item
  The
  \href{https://www.theice.com/products/219/Brent-Crude-Futures}{Brent}
  and
  \href{https://www.theice.com/products/34361119/Low-Sulphur-Gasoil-Futures}{Gasoil}
  Futures prices traded in the Intercontinental Exchange (ICE) were
  taken from
  \href{https://www.quandl.com/data/SCF/documentation/about}{Quandl's
  Steven Continuous Series} using the `Roll on Last Trading Day with No
  Price Adjustment' version and the `Settle' field
\item
  The two series were joined to produce a single dataset consisting of
  daily settlement prices for Brent and Gasoil
\item
  The dataset spans 1.5 `trading years'. The period selected was
  Jan-2014 to Dec-2014 for the in-sample testing and Jan-2015 to
  Jun-2015 for the out-of-sample testing. This was because several
  sources recommend to use one year of historic data to estimate the
  cointegration parameters and trade the estimates for a 6-month period,
  given that the parameters might change over time or the relationship
  cease to exist
\item
  Dates with missing values after joining the two series were dropped
\item
  Since Gasoil is traded in metric tons and Brent in barrels, the gasoil
  series was divided by 7.45, which is the
  \href{https://www.theice.com/publicdocs/futures/ICE_Gas_Oil_Crack.pdf}{ICE
  conversion factor}
\end{itemize}

The figure below shows the resulting dataset (spanning both in-sample
and out-of-sample periods), where the two series indeed seem to be
closely related, having parallel up and down trends.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{temp} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{data/df\PYZus{}brent\PYZus{}gasoil.csv}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{parse\PYZus{}dates}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{,} \PY{n}{dayfirst}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
        \PY{n}{df} \PY{o}{=} \PY{n}{temp}\PY{p}{[}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2014}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2015}\PY{p}{,} \PY{l+m+mi}{6}\PY{p}{,} \PY{l+m+mi}{30}\PY{p}{)}\PY{p}{]}
        \PY{n}{df\PYZus{}is} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2014}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2014}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{31}\PY{p}{)}\PY{p}{]}  \PY{c}{\PYZsh{} in\PYZhy{}sample dataset}
        \PY{n}{df\PYZus{}os} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2015}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2015}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{31}\PY{p}{)}\PY{p}{]}  \PY{c}{\PYZsh{} out\PYZhy{}of\PYZhy{}sample dataset}
        \PY{k}{print} \PY{n}{df}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
        \PY{k}{print} \PY{n}{df}\PY{o}{.}\PY{n}{tail}\PY{p}{(}\PY{p}{)}
        \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
brent      gasoil
Date                          
2014-01-02  107.78  123.959732
2014-01-03  106.89  122.181208
2014-01-06  106.73  122.181208
2014-01-07  107.35  122.214765
2014-01-08  107.15  122.449664
            brent     gasoil
Date                        
2015-06-24  63.49  77.986577
2015-06-25  63.20  76.543624
2015-06-26  63.26  77.046980
2015-06-29  62.01  75.771812
2015-06-30  63.59  77.013423
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_8_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \section{Stationarity and
Mean-Reversion}\label{stationarity-and-mean-reversion}

    Before cointegration is introduced, it is important to understand the
concept of stationarity. A time series is stationary when the parameters
of its generating process do not change over time. In particular, its
long-run mean and variance stay constant. This property is fundamental
when applying linear regression and forecasting models.

Often, processes with a drift or trend, like stock prices, are
non-stationary but can be transformed to become stationary. For example,
by differencing prices we get returns, which are in general stationary.

The figure below shows how a simulated random walk with drift
\(Y_t = \alpha + Y_{t-1} + \epsilon_t\) can be made stationary by
differencing \(Y_t - Y_{t-1} = \alpha + \epsilon_t\)

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}51}]:} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{l+m+mi}{1000}\PY{p}{)}  \PY{c}{\PYZsh{} set the seed}
         \PY{n}{M} \PY{o}{=} \PY{l+m+mi}{1000}  \PY{c}{\PYZsh{} no. of time steps}
         \PY{n}{Y\PYZus{}t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{Y\PYZus{}t}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{0.0}  \PY{c}{\PYZsh{} initial value}
         \PY{n}{a} \PY{o}{=} \PY{l+m+mf}{0.1}  \PY{c}{\PYZsh{} drift}
         
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{xrange}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{n}{Y\PYZus{}t}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{a} \PY{o}{+} \PY{n}{Y\PYZus{}t}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Y\PYZus{}t = pd.Series(index=range(M), data=Y\PYZus{}t)}
         \PY{n}{Y\PYZus{}t} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{Y\PYZus{}t}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{Y\PYZus{}t}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{Y\PYZus{}t}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{c}{\PYZsh{} \PYZus{} = plt.ylabel(\PYZsq{}Series Value\PYZsq{})}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Time}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{Random walk with drift}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{Stationary Difference}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{upper left}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_11_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Mean-Reversion}\label{mean-reversion}

A stationary series is mean-reverting if over time it drifts towards its
long-term mean (the historical equilibrium level). A popular model in
this category is the Ornstein--Uhlenbeck (OU) process:

\[
dY_t = \theta(\mu - Y_t)dt + \sigma dW_t
\]

where \(\theta\) is the speed of reversion, \(\mu\) is the equilibrium
level, \(\sigma\) the variance and \(W_t\) a Wiener Process (Brownian
Motion). In a discrete setting this states that the further away the
process is from the mean, the greater the `pull back' to it is. This is
in contrast to the random walk above, which has no ``memory'' of where
it has been at each particular instance of time.

The figure below shows three OU processes with the same mean \(\mu=10\)
but different mean-reversion speeds. Indeed it can be noted the highest
speed reverts to the mean first. The differences \(dY_t\) are plotted
below and these appear to become stationary significantly faster than
the process itself, almost insensitive to the speed \(\theta\).

Therefore, if we are able to transform a time series to be stationary
and mean-reverting, we can design trading strategies using these
properties which are more independent of market effects. In a later
section we shall see how the OU parameters can be used to design
exit/entry thresholds and also assess the `quality' of mean-reversion.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}52}]:} \PY{k+kn}{import} \PY{n+nn}{math}
         \PY{k+kn}{from} \PY{n+nn}{math} \PY{k+kn}{import} \PY{n}{exp}\PY{p}{,} \PY{n}{sqrt}\PY{p}{,} \PY{n}{log}
         
         \PY{c}{\PYZsh{} MC params}
         \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{l+m+mi}{2000}\PY{p}{)}  \PY{c}{\PYZsh{} set the seed}
         \PY{n}{dt} \PY{o}{=} \PY{l+m+mi}{1}  \PY{c}{\PYZsh{} time step}
         \PY{n}{M} \PY{o}{=} \PY{l+m+mi}{1000}  \PY{c}{\PYZsh{} no. of time steps}
         
         \PY{c}{\PYZsh{} Model params:}
         \PY{n}{mu} \PY{o}{=} \PY{l+m+mi}{10}
         \PY{n}{sigma} \PY{o}{=} \PY{l+m+mf}{0.3}
         
         \PY{n}{Y\PYZus{}t1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{Y\PYZus{}t2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{Y\PYZus{}t3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{Y\PYZus{}t1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{50.0}
         \PY{n}{Y\PYZus{}t2}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{50.0}
         \PY{n}{Y\PYZus{}t3}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{=} \PY{l+m+mf}{0.0}
         
         \PY{n}{theta1} \PY{o}{=} \PY{l+m+mf}{0.003}
         \PY{n}{theta2} \PY{o}{=} \PY{l+m+mf}{0.01}
         \PY{n}{theta3} \PY{o}{=} \PY{l+m+mf}{0.1}
         
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{xrange}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{M} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
             \PY{n}{Y\PYZus{}t1}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{Y\PYZus{}t1}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{theta1} \PY{o}{*} \PY{p}{(}\PY{n}{mu} \PY{o}{\PYZhy{}} \PY{n}{Y\PYZus{}t1}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{n}{dt} \PY{o}{+} \PY{n}{sigma} \PY{o}{*} \PY{n}{math}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{dt}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{Y\PYZus{}t2}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{Y\PYZus{}t2}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{theta2} \PY{o}{*} \PY{p}{(}\PY{n}{mu} \PY{o}{\PYZhy{}} \PY{n}{Y\PYZus{}t2}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{n}{dt} \PY{o}{+} \PY{n}{sigma} \PY{o}{*} \PY{n}{math}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{dt}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{Y\PYZus{}t3}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{Y\PYZus{}t3}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{theta3} \PY{o}{*} \PY{p}{(}\PY{n}{mu} \PY{o}{\PYZhy{}} \PY{n}{Y\PYZus{}t3}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{n}{dt} \PY{o}{+} \PY{n}{sigma} \PY{o}{*} \PY{n}{math}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{dt}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Y\PYZus{}t = pd.Series(index=range(M), data=Y\PYZus{}t)}
         \PY{n}{Y\PYZus{}t1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{Y\PYZus{}t1}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t1}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{Y\PYZus{}t2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{Y\PYZus{}t2}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t2}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{Y\PYZus{}t3} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{Y\PYZus{}t3}\PY{p}{,} \PY{n}{name}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t3}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}53}]:} \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
         \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{height\PYZus{}ratios}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
         \PY{c}{\PYZsh{} plt.subplot(211)}
         
         \PY{c}{\PYZsh{} f, (a0, a1) = plt.subplots(2, 1, gridspec\PYZus{}kw = \PYZob{}\PYZsq{}height\PYZus{}ratios\PYZsq{}:[2, 1]\PYZcb{})}
         \PY{c}{\PYZsh{} a0.plot(Y\PYZus{}t1)}
         \PY{c}{\PYZsh{} a0.plot(Y\PYZus{}t2)}
         \PY{c}{\PYZsh{} a0.plot(Y\PYZus{}t3)}
         \PY{c}{\PYZsh{} a0.axhline(mu, color=\PYZsq{}grey\PYZsq{}, linestyle=\PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}) }
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{Y\PYZus{}t1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{Y\PYZus{}t2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{Y\PYZus{}t3}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{mu}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{grey}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)} 
         
         \PY{c}{\PYZsh{} \PYZus{} = plt.ylabel(\PYZsq{}Series Value\PYZsq{})}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Ornstein\PYZhy{}Uhlenbeck process for different mean\PYZhy{}reversion speeds}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{theta=\PYZob{}0\PYZcb{}, Y\PYZus{}0=\PYZob{}1:0.0f\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{theta1}\PY{p}{,} \PY{n}{Y\PYZus{}t1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,} 
                     \PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{theta=\PYZob{}0\PYZcb{}, Y\PYZus{}0=\PYZob{}1:0.0f\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{theta2}\PY{p}{,} \PY{n}{Y\PYZus{}t2}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,}
                     \PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{theta=\PYZob{}0\PYZcb{}, Y\PYZus{}0=\PYZob{}1:0.0f\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{theta3}\PY{p}{,} \PY{n}{Y\PYZus{}t3}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,}
                     \PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{mu=\PYZob{}0\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{mu}\PY{p}{)}\PY{p}{]}\PY{p}{,}
                    \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         
         \PY{c}{\PYZsh{} \PYZsh{} plt.subplot(212)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{sharex}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Differences}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{Y\PYZus{}t1}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{Y\PYZus{}t2}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{Y\PYZus{}t3}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}dY\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Time}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}53}]:} <matplotlib.text.Text at 0x18e5d4a8>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_14_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Tests}\label{tests}

    We require a more robust method to confirm statistically whether a
series is stationary. Several tests exist, such as the \textbf{Augmente
Dickey-Fuller (ADF)} test, Phillips--Perron test, Hurst exponent, Kalman
filters, etc.

Here we only implement the ADF test and the mathematical details can be
found in the Appendix.

    \subsubsection{ADF test implementation}\label{adf-test-implementation}

The ADF test equation implemented was: \[
\Delta Y_t = c_0 + \phi Y_{t-1} + \sum^p_k \phi_k \Delta Y_{t-k} + \epsilon_t 
\] where a time trend term has not been included due to the nature of
financial time series \href{}{ref missing}. The coefficients are
estimated using the familiar linear regression (see Appendix) whereas
the optimal lag order \emph{p} is discussed below. The python script can
be found in \emph{analysis.py}. All the results were validated against
the popular python equivalents from the
\href{http://statsmodels.sourceforge.net/}{statsmodels library}.

    \paragraph{Optimal Lag Selection}\label{optimal-lag-selection}

Choice of lag order can be a difficult problem. Standard approaches use
an \emph{information criteria}, such as the Akaike Information Criterion
(AIC). However, different methods can lead to different results. Also,
keeping more lags can lead to \emph{model overfitting}. In practice, the
choice of optimal lag is also evident from the
\href{http://nl.mathworks.com/help/econ/autocorrelation-and-partial-autocorrelation.html}{Partial
Autocorrelation Function} (PACF) since the significant lags would show
above confidence limits.

Typically for the ADF test it is enough to take \emph{p=1}, however in
the interest of exploring this aspect, here we look at the results using
AIC an PACF.

\begin{itemize}
\tightlist
\item
  \textbf{AIC:} iterating over different lag orders, the one yielding
  the lowest AIC value is taken as the optimal lag. For the simulated
  random-walk-with-drift and OU processes above the results are
  summarised in the table below.
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}54}]:} \PY{o}{\PYZpc{}}\PY{k}{run} analysis.py
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}55}]:} \PY{c}{\PYZsh{} GET OPTIMAL LAG for Y\PYZus{}T\PYZsq{}s}
         
         \PY{n}{y\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{Y\PYZus{}t}\PY{p}{,} \PY{n}{Y\PYZus{}t1}\PY{p}{,} \PY{n}{Y\PYZus{}t2}\PY{p}{,} \PY{n}{Y\PYZus{}t3}\PY{p}{]}  \PY{c}{\PYZsh{} process list}
         \PY{n}{my\PYZus{}lag\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{sm\PYZus{}lag\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         
         \PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{y\PYZus{}list}\PY{p}{:}
             \PY{c}{\PYZsh{} Set maximum lag to iterate over }
             \PY{c}{\PYZsh{} (using default in statsmodels 12*(nobs/100)\PYZca{}\PYZob{}1/4\PYZcb{}), from Greene referencing Schwert 1989)}
             \PY{n}{nobs} \PY{o}{=} \PY{n}{y}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{maxlag} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{l+m+mf}{12.} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{power}\PY{p}{(}\PY{n}{nobs} \PY{o}{/} \PY{l+m+mf}{100.}\PY{p}{,} \PY{l+m+mi}{1} \PY{o}{/} \PY{l+m+mf}{4.}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{maxlag tried for \PYZob{}0\PYZcb{} = \PYZob{}1\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{maxlag}\PY{p}{)}
             \PY{n}{my\PYZus{}bestlag} \PY{p}{,} \PY{n}{my\PYZus{}icbest} \PY{o}{=} \PY{n}{get\PYZus{}optimal\PYZus{}lag}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{n}{maxlag}\PY{p}{,} \PY{n}{model}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{adf}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             \PY{n}{sm\PYZus{}result} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{n}{maxlag}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{AIC}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
             \PY{n}{my\PYZus{}lag\PYZus{}list} \PY{o}{+}\PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{my\PYZus{}bestlag}\PY{p}{,} \PY{n}{my\PYZus{}icbest}\PY{p}{)}\PY{p}{]}
         
             \PY{n}{sm\PYZus{}bestlag} \PY{o}{=} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{usedlag}
             \PY{n}{sm\PYZus{}icbest} \PY{o}{=} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{icbest}
             \PY{n}{sm\PYZus{}lag\PYZus{}list} \PY{o}{+}\PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{sm\PYZus{}bestlag}\PY{p}{,} \PY{n}{sm\PYZus{}icbest}\PY{p}{)}\PY{p}{]}
         
         \PY{k}{print} \PY{n}{my\PYZus{}lag\PYZus{}list}
         \PY{k}{print} \PY{n}{sm\PYZus{}lag\PYZus{}list}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
maxlag tried for Y\_t = 22
maxlag tried for Y\_t1 = 22
maxlag tried for Y\_t2 = 22
maxlag tried for Y\_t3 = 22
[('Y\_t', 22, 2822.9284724156405), ('Y\_t1', 1, 510.65130344092904), ('Y\_t2', 10, 409.88362605882116), ('Y\_t3', 2, 345.78667361444377)]
[('Y\_t', 0L, 2792.2436461854049), ('Y\_t1', 0L, 498.79608347313001), ('Y\_t2', 0L, 401.56429387239655), ('Y\_t3', 0L, 322.01280549403577)]
    \end{Verbatim}

    \begin{longtable}[c]{@{}lll@{}}
\toprule
Process & OU theta & AIC optimal lag\tabularnewline
\midrule
\endhead
Y\_t & 0 & 22\tabularnewline
Y\_t1 & 0.003 & 1\tabularnewline
Y\_t2 & 0.010 & 10\tabularnewline
Y\_t3 & 0.100 & 2\tabularnewline
\bottomrule
\end{longtable}

    \begin{itemize}
\tightlist
\item
  \textbf{PACF:} Given that the optimal lag order from AIC comes out
  quite high for all, except for Y\_t1 and Y\_t2, we instead use the
  empirical results from the PACF plot below, where it can be seen for
  all only the first lag is well above the 95\% confidence band (the
  first `spike' represents \emph{p=0}). Given this, we therefore assume
  it is `safe' to take \emph{p=1} to carry out the ADF test.
\end{itemize}

    

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}56}]:} \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.graphics.tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}pacf}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
         \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{y} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{y\PYZus{}list}\PY{p}{)}\PY{p}{:}       
             \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
             \PY{n}{fig} \PY{o}{=} \PY{n}{plot\PYZus{}pacf}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{lags}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{l+m+mf}{40.5}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.85}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{x\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}
         \PY{c}{\PYZsh{}     if i \PYZlt{} 3:  \PYZsh{} set ticks to invisible}
         \PY{c}{\PYZsh{}         plt.xticks([])}
         \PY{c}{\PYZsh{}     if i == 1:}
         \PY{c}{\PYZsh{}         plt.ylabel(\PYZdq{}Correlation\PYZdq{})}
             \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{l+m+mi}{3}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lag}\PY{l+s}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_24_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{ADF}\label{adf}

Using as optimal lag \emph{p=1}, we run the ADF test and compare the
corresponding t-statistic to the critical values (taken from
statsmodels, based on
\href{http://statsmodels.sourceforge.net/stable/generated/statsmodels.tsa.stattools.adfuller.html\#statsmodels.tsa.stattools.adfuller}{MacKinnon
(2010)}). The results are summarised in the table below, with perhaps an
unexpected result for Y\_t3 - the OU process with the largest
mean-reversion speed is non-stationary under the ADF test. For the rest
is as expected. This highlights the need of carrying additional tests
for stationarity instead of just relying on one?

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}470}]:} \PY{n}{my\PYZus{}result} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}  \PY{c}{\PYZsh{} result using my implementation}
          \PY{n}{sm\PYZus{}result} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}  \PY{c}{\PYZsh{} statsmodels result}
          
          \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{y} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{y\PYZus{}list}\PY{p}{)}\PY{p}{:}
              \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{)}
              \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{y}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
              \PY{c}{\PYZsh{} Also do it for the differences, note different lag used}
              \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{d}\PY{l+s}{\PYZsq{}} \PY{o}{+} \PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{y}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{)}
              \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{d}\PY{l+s}{\PYZsq{}} \PY{o}{+} \PY{n}{y}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{y}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Print results}
          \PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{my\PYZus{}result}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
              \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}0\PYZcb{}: \PYZob{}1:.4f\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{adfstat}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
              \PY{k}{print} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}
              \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{pvalue=}\PY{l+s+si}{\PYZpc{}0.4g}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
dY\_t2: -29.3639
(-29.36390932844888, 0.0, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002BA8E198>)
pvalue=0
dY\_t1: -29.4587
(-29.458702182847425, 0.0, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002DEE00F0>)
pvalue=0
dY\_t3: -31.3506
(-31.350558750248219, 0.0, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002F1B01D0>)
pvalue=0
Y\_t: 0.1093
(0.10928529332167412, 0.96668935601503581, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002CB5C9E8>)
pvalue=0.9667
Y\_t1: -6.0020
(-6.0020080361970347, 1.6488401737025808e-07, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x0000000024085518>)
pvalue=1.649e-07
Y\_t2: -8.7597
(-8.7597377226616739, 2.694369841413676e-14, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002EA2E9B0>)
pvalue=2.694e-14
Y\_t3: -10.1133
(-10.113274216656343, 9.8743506405421961e-18, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002BA8E518>)
pvalue=9.874e-18
dY\_t: -31.8476
(-31.847550654937869, 0.0, \{'5\%': -2.864437475834273, '1\%': -3.4369127451400474, '10\%': -2.568312754566378\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000002F0E3198>)
pvalue=0
    \end{Verbatim}

    \begin{longtable}[c]{@{}lllllll@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\raggedright\strut
Process
\strut\end{minipage} &
\begin{minipage}[b]{0.09\columnwidth}\raggedright\strut
Theta
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
ADF t-stat
\strut\end{minipage} &
\begin{minipage}[b]{0.18\columnwidth}\raggedright\strut
5\% Crit. Val.
\strut\end{minipage} &
\begin{minipage}[b]{0.12\columnwidth}\raggedright\strut
p-value
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
Stationary
\strut\end{minipage} &
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Stable
\strut\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
Y\_t
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
0.1093
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
0.9667
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
No
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
Y\_t1
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.003
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-6.0020
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
1.65E-07
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
Y\_t2
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.01
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-8.7597
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
2.69E-14
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
Y\_t3
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.1
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-10.1133
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
9.87E-18
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
dY\_t
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-31.8476
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
0.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
No
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
dY\_t1
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.003
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-29.4587
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
0.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
dY\_t2
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.01
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-29.3639
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
0.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
dY\_t3
\strut\end{minipage} &
\begin{minipage}[t]{0.09\columnwidth}\raggedright\strut
0.1
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-31.3506
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.8644
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\raggedright\strut
0.0
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
No
\strut\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

    \paragraph{Stability Check}\label{stability-check}

To ensure further the reliability of results, a stability check can be
done on the estimated coefficients by looking at their eigenvalues
within the unit circle (see Appendix for details). The results of the
self-implementation are displayed in the table above. All cases were
found stable, except dY\_t and dY\_t3. This demonstrates that
stationarity does not imply stability. The unstable nature of dY\_t may
be due to the drift term added \(dY_t = \alpha + \epsilon_t\). A close
inspection of the problematic root of dY\_t3 shows it is just right on
the boundary of the unit circle.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}475}]:} \PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{my\PYZus{}result}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
          \PY{c}{\PYZsh{}     print key, my\PYZus{}result[key][\PYZsq{}roots\PYZsq{}], sm\PYZus{}result[key][3].roots}
              \PY{k}{print} \PY{n}{key}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
              \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}0\PYZcb{} passes stability check: \PYZob{}1\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{is\PYZus{}stable}\PY{p}{(}\PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
dY\_t2 [  1.13343394  22.21695591]
dY\_t2 passes stability check: True
dY\_t1 [  1.01435783  17.50069413]
dY\_t1 passes stability check: True
dY\_t3 [   0.99769382  114.54000516]
dY\_t3 passes stability check: False
Y\_t [ 2.24454786  2.24454786  2.29331194]
Y\_t passes stability check: True
Y\_t1 [ 2.71044769  3.15598108  3.15598108]
Y\_t1 passes stability check: True
Y\_t2 [ 2.06150444  2.07651681  2.07651681]
Y\_t2 passes stability check: True
Y\_t3 [ 1.00769613  1.00769613  1.05473821]
Y\_t3 passes stability check: True
dY\_t [  0.91600204  11.98589696]
dY\_t passes stability check: False
    \end{Verbatim}

    \subsubsection{Other useful plots}\label{other-useful-plots}

When assessing stationarity, the below plots could also be used (see
\href{http://pandas.pydata.org/pandas-docs/stable/visualization.html\#autocorrelation-plot}{pandas
ref1},
\href{https://github.com/pydata/pandas/blob/master/pandas/tools/plotting.py}{pandas
ref2}):

\begin{itemize}
\tightlist
\item
  \textbf{Autocorrelation plot:} this shows the autocorrelation function
  (ACF) at varying time lags. For perfectly stationary series or iid
  random variables, the autocorrelations should be near zero for all
  time-lag separations. The horizontal lines displayed in the plot
  correspond to 95\% and 99\% C.L. Indeed in the example below none of
  the differenced processes show significant autocorrelation. Also the
  OU process with the highest mean-reversion speed Y\_t3 rapidly looses
  autocorrelation to its lags, looking more like stationary.
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}356}]:} \PY{k+kn}{from} \PY{n+nn}{pandas.tools.plotting} \PY{k+kn}{import} \PY{n}{autocorrelation\PYZus{}plot}
          
          \PY{n}{p\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{Y\PYZus{}t}\PY{p}{,} \PY{n}{Y\PYZus{}t1}\PY{p}{,} \PY{n}{Y\PYZus{}t2}\PY{p}{,} \PY{n}{Y\PYZus{}t3}\PY{p}{]}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}
          
          \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{p} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{p\PYZus{}list}\PY{p}{)}\PY{p}{:}
              \PY{n}{autocorrelation\PYZus{}plot}\PY{p}{(}\PY{n}{p}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{n}{p}\PY{o}{.}\PY{n}{name}\PY{p}{)}
          
          \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{p} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{p\PYZus{}list}\PY{p}{)}\PY{p}{:}
              \PY{n}{autocorrelation\PYZus{}plot}\PY{p}{(}\PY{n}{p}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{d}\PY{l+s}{\PYZsq{}}\PY{o}{+}\PY{n}{p}\PY{o}{.}\PY{n}{name}\PY{p}{)}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_31_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{itemize}
\tightlist
\item
  \textbf{Lag plot:} this is a scatter plot between the series \(Y_t\)
  and one of its lags \(Y_{t-p}\). Like in the autocorrelation plot, a
  stationary series would not exhibit any relationship. Below an example
  is shown for two of the OU processes and their differences. This
  confirms the results from the autocorrelation plot - the fastes
  mean-reverting Y\_t3 has little relation to the 10th lag, unlike Y\_t1
  which has a lower speed. As expected, the stationary differences are
  insensitive to the lags, even for \(Y_{t-1}\).
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}421}]:} \PY{k+kn}{from} \PY{n+nn}{pandas.tools.plotting} \PY{k+kn}{import} \PY{n}{lag\PYZus{}plot}
          
          \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
          \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
          
          \PY{n}{lag\PYZus{}plot}\PY{p}{(}\PY{n}{Y\PYZus{}t1}\PY{p}{,} \PY{n}{lag}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t1}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{markerscale}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZhy{}10\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{lag\PYZus{}plot}\PY{p}{(}\PY{n}{Y\PYZus{}t3}\PY{p}{,} \PY{n}{lag}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{Y\PYZus{}t3}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{markerscale}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZhy{}10\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{lag\PYZus{}plot}\PY{p}{(}\PY{n}{Y\PYZus{}t1}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{lag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{dY\PYZus{}t1}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{markerscale}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZhy{}1\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{lag\PYZus{}plot}\PY{p}{(}\PY{n}{Y\PYZus{}t3}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{lag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{dY\PYZus{}t3}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{markerscale}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{r\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZhy{}1\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}Y\PYZus{}\PYZob{}t\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}421}]:} <matplotlib.text.Text at 0x2ee3d160>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_33_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \section{Cointegration}\label{cointegration}

    Having covered the key concepts to understand cointegration, we proceed
to explain this topic.

Two or more time series \$\mathbf{Y}\emph{t = (y}\{1t\}, \dots,
y\_\{nt\})\^{}\prime \$ are said to be cointegrated if a linear
combination exists which makes the collection ``integrated of order
zero'' I(0) i.e stationary:

\[
\mathbf{\beta^\prime Y}_t = \beta_1 y_{1t} + \dots + \beta_n y_{nt} \sim I(0)
\]

This is known as the \emph{long-run (static) equilibrium} model and is
expressed in normalised form as:

\[
y_{1t} = \beta_2 y_{2t} + \dots + \beta_n y_{nt} + e_t
\]

where the residual \(e_t \sim I(0)\) is referred to as the
\emph{cointegrating residual/spread} and
\(\mathbf{\beta} = (1, -\beta_2, \dots, -\beta_n)^\prime\) is the
\emph{cointegrating vector}.

Due to time constrains, this report only covers only a pair of
cointegrated time series, however the concept can be extended to more
series and higher orders of integration.

In real data, cointegration ususally exists when there is a deep
economic link between the assets and hence these cannot drift too far
apart because economic forces will act to restore the long-run
equilibrium. The figure below shows a simulated pair of cointegrated
assets \(y_{1t}\) and \(y_{2t}\), where \(y_{2t}\) is defined as an I(1)
process. If \(y_{1t}\) is supposed to have a strong link to \(y_{2t}\),
the price of \(y_{1t}\) should vary similarly. This is simulated by
shifting up \(y_{2t}\) and adding some noise (residual) drawn from a
normal distribution, so \(y_{1t}\) is defined as the dependent variable
and \(y_{2t}\) as the independent variable:

\[
y_{1t} = y_{2t} + 5.0 + \epsilon_t
\]

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{N} \PY{o}{=} \PY{l+m+mi}{250} \PY{c}{\PYZsh{} length of series}
        
        \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{l+m+mi}{2000}\PY{p}{)}
        
        \PY{c}{\PYZsh{} Generate a stationary random y\PYZus{}2t}
        \PY{n}{y\PYZus{}2t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{p}{)}
        \PY{c}{\PYZsh{} Integrate it to make it I(1)}
        \PY{n}{y\PYZus{}2t} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{y\PYZus{}2t}\PY{p}{)}
        \PY{n}{y\PYZus{}2t} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{y\PYZus{}2t}\PY{p}{)}
        \PY{n}{y\PYZus{}2t}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{y\PYZus{}2t}\PY{l+s}{\PYZsq{}}  \PY{c}{\PYZsh{} independent variable}
        
        \PY{c}{\PYZsh{} Make an y\PYZus{}1t that is y\PYZus{}2t plus some noise}
        \PY{n}{some\PYZus{}noise} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{N}\PY{p}{)}
        \PY{n}{shift} \PY{o}{=} \PY{l+m+mf}{5.0}
        \PY{n}{y\PYZus{}1t} \PY{o}{=} \PY{n}{y\PYZus{}2t} \PY{o}{+} \PY{n}{shift} \PY{o}{+} \PY{n}{some\PYZus{}noise}
        \PY{n}{y\PYZus{}1t}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{y\PYZus{}1t}\PY{l+s}{\PYZsq{}}  \PY{c}{\PYZsh{} dependent variable}
        
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{y\PYZus{}2t}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{y\PYZus{}1t}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Time}\PY{l+s}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Value}\PY{l+s}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Simulated Cointegrated Series}\PY{l+s}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{n}{y\PYZus{}2t}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{y\PYZus{}1t}\PY{o}{.}\PY{n}{name}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}\PY{p}{;}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_36_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Tests}\label{tests}

Again, we need a robust statistical test to confirm cointegration. The
three main approaches are:

\begin{itemize}
\item
  \textbf{Engle--Granger two-step method:} this can only be used to test
  a \emph{single} cointegrating relationship. The steps are:

  \begin{enumerate}
  \def\labelenumi{(\roman{enumi})}
  \item
    Estimate the cointegrating residual \$ \hat{e}\_t =
    \mathbf{\hat{\beta}^\prime} \mathbf{Y}\_t\$, e.g.~using linear
    regression
  \item
    Test \(\hat{e}_t\) for stationarity, e.g.~using the ADF test, where
    the hypotheses to be tested are:
  \end{enumerate}

  \[
  \begin{equation}
  H_0 \space :  \space \hat{e}_t = \mathbf{\hat{\beta}^\prime} \mathbf{Y}_t \sim I(1) \qquad \mathrm{(no \space cointegration)} \\
  H_1 \space :  \space \hat{e}_t = \mathbf{\hat{\beta}^\prime} \mathbf{Y}_t \sim I(0) \qquad \mathrm{(cointegration)}
  \end{equation}
  \]
\end{itemize}

We refer to this use case of the ADF as `CADF'

\begin{itemize}
\item
  \textbf{Johansen test:} based on maximum likelihood techniques, this
  allows for more than one cointegrating relationship, but it is subject
  to asymptotic conditions when if the sample size is too small
\item
  \textbf{Phillips--Ouliaris test:} uses a modified version of the
  Dickey-Fuller distribution to test the cointegrating spread for
  stationarity. This is a better choice when dealing with small samples
\end{itemize}

In this project only the Engle-Granger two-step method is considered.

    \subsubsection{Engle-Granger test
implementation}\label{engle-granger-test-implementation}

    For our simulated cointegrated series, the cointegration relationship is
then repesented by the regression:

\[
y_{1t} = c + \beta_2^\prime y_{2t} + e_t
\]

whose parameters are estimated using OLS. Hence, the estimated
cointegrating spread is:

\[
\hat{e}_t = y_{1t} - \hat{c} - \hat{\beta}_2^\prime y_{2t}
\]

We then test \(\hat{e}_t\) for stationarity using ADF. Since the mean of
\(\hat{e}_t\) is zero, the ADF can be implemented without a constant or
trend (See
\href{file:///C:/Users/Tanya.Sandoval/Downloads/Cointegration\%20-\%20Book\%20Chapter\%20-\%20UWashington\%20E\%20Zivot.pdf}{ref
p445}). Also note that the critical values used are taken as in
statsmodels from MacKinnon (2010)
\href{http://statsmodels.sourceforge.net/stable/generated/statsmodels.tsa.stattools.adfuller.html\#statsmodels.tsa.stattools.adfuller}{(see
ref)}, whereas other sources suggest to use the Phillips-Ouliaris
tabulation in this case.

The figure below shows the OLS fit:

\[
\hat{y}_{1t} = 5.0330 + 1.0052 y_{2t} + \hat{e}_t
\]

which is in good agreement with its true value. Plotted also is the
estimated \(\hat{e}_t\) and its PACF. The PACF shows the spread is
\emph{memoryless}, i.e.~no lag order appears significant so it's a
random (Markov) process.

Although \(\hat{e}_t\) appeared memoryless, conservatively the CADF
t-statistic was computed using one lag. This was \(-12.051\), which was
below the \(1\%\) critical value (\(-2.5748\)), confirming the
stationarity of the spread, which by design we expected.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c}{\PYZsh{} ======  ENGLE\PYZhy{}GRANGER 2\PYZhy{}STEP METHOD  ======}
        
        \PY{c}{\PYZsh{} ===== STEP 1: GET SPREAD FROM OLS =====}
        
        \PY{c}{\PYZsh{} My OLS and ADF implementatin}
        \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{my\PYZus{}OLS}
        
        \PY{c}{\PYZsh{} Import statsmodels equivalents to validate results}
        \PY{k+kn}{from} \PY{n+nn}{statsmodels.tsa.tsatools} \PY{k+kn}{import} \PY{n}{add\PYZus{}constant}
        \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
        
        \PY{n}{y\PYZus{}2t} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{y\PYZus{}2t}\PY{p}{)}
        \PY{n}{my\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{my\PYZus{}OLS}\PY{p}{(}\PY{n}{y\PYZus{}1t}\PY{p}{,} \PY{n}{y\PYZus{}2t}\PY{p}{)}
        \PY{n}{sm\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{y\PYZus{}1t}\PY{p}{,} \PY{n}{y\PYZus{}2t}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} validate result with statsmodels}
        \PY{n}{y\PYZus{}2t} \PY{o}{=} \PY{n}{y\PYZus{}2t}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}  \PY{c}{\PYZsh{} remove the constant now that we\PYZsq{}re done}
        
        \PY{c}{\PYZsh{} Set values of estimated parameters}
        \PY{n}{c\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{n}{beta2\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
        
        \PY{c}{\PYZsh{} cointegration spread}
        \PY{n}{e\PYZus{}t\PYZus{}hat} \PY{o}{=} \PY{n}{y\PYZus{}1t} \PY{o}{\PYZhy{}} \PY{n}{c\PYZus{}hat} \PY{o}{\PYZhy{}} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{y\PYZus{}2t}  \PY{c}{\PYZsh{} == sm\PYZus{}res\PYZus{}ols.resid ==  my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}]}
        \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat}\PY{l+s}{\PYZsq{}}
        
        \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}params\PYZsq{}]}
        \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.params}
        \PY{n}{sm\PYZus{}res\PYZus{}ols}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
        \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}].head()}
        \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.resid.head()}
        \PY{c}{\PYZsh{} print e\PYZus{}t\PYZus{}hat.head()}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}7}]:} <class 'statsmodels.iolib.summary2.Summary'>
        """
                          Results: Ordinary least squares
        ==================================================================
        Model:              OLS              Adj. R-squared:     0.990    
        Dependent Variable: y\_1t             AIC:                725.9157 
        Date:               2016-07-23 17:32 BIC:                732.9586 
        No. Observations:   250              Log-Likelihood:     -360.96  
        Df Model:           1                F-statistic:        2.412e+04
        Df Residuals:       248              Prob (F-statistic): 4.58e-249
        R-squared:          0.990            Scale:              1.0595   
        ---------------------------------------------------------------------
                 Coef.     Std.Err.       t        P>|t|     [0.025    0.975]
        ---------------------------------------------------------------------
        const    5.0330      0.1000     50.3359    0.0000    4.8360    5.2299
        y\_2t     1.0052      0.0065    155.2941    0.0000    0.9924    1.0179
        ------------------------------------------------------------------
        Omnibus:              2.007         Durbin-Watson:           2.217
        Prob(Omnibus):        0.367         Jarque-Bera (JB):        1.696
        Skew:                 -0.059        Prob(JB):                0.428
        Kurtosis:             2.614         Condition No.:           24   
        ==================================================================
        
        """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}48}]:} \PY{c}{\PYZsh{} ===== PLOT OLS FIT  =====}
         
         \PY{c}{\PYZsh{} generate equally spaced X values between true X range}
         \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{y\PYZus{}2t}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{y\PYZus{}2t}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Plot the estimated dependent variable}
         \PY{n}{y\PYZus{}1t\PYZus{}hat} \PY{o}{=} \PY{n}{c\PYZus{}hat} \PY{o}{+} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{x}
         
         \PY{c}{\PYZsh{} Plot own fit on top of seaborn scatter + fit}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cointegrated series regression}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{sns}\PY{o}{.}\PY{n}{regplot}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{y\PYZus{}2t}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{y\PYZus{}1t}\PY{p}{,} \PY{n}{fit\PYZus{}reg}\PY{o}{=}\PY{n+nb+bp}{False}\PY{p}{)}  \PY{c}{\PYZsh{} true values}
         \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y\PYZus{}1t\PYZus{}hat}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{r}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{OLS fit}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{simulated data}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}48}]:} <matplotlib.legend.Legend at 0x108b56d8>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_41_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}51}]:} \PY{c}{\PYZsh{} ===== CHECK OPTIMAL LAG ORDER  =====}
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.graphics.tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}pacf}
         \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
         \PY{c}{\PYZsh{} gs = gridspec.GridSpec(2, 1, height\PYZus{}ratios=[3, 1])}
         \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Plot cointegrated residual}
         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cointegrating spread \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)} \PY{c}{\PYZsh{} Add the mean}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{mean(\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{})}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plot\PYZus{}pacf}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{lags}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Partial Autocorrelation \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{c}{\PYZsh{} plt.text(x=40.5, y=0.85, s=\PYZsq{}\PYZdl{}\PYZbs{}hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}\PYZsq{}, size=\PYZsq{}xx\PYZhy{}large\PYZsq{})}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}51}]:} <matplotlib.text.Text at 0x117539e8>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_42_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_42_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}46}]:} \PY{c}{\PYZsh{} ======  ENGLE\PYZhy{}GRANGER 2\PYZhy{}STEP METHOD  ======}
         
         \PY{c}{\PYZsh{} ===== STEP 2: ADF TEST ON SPREAD  =====}
         
         \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{my\PYZus{}adfuller}
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.tsa.stattools} \PY{k+kn}{import} \PY{n}{adfuller}
         
         \PY{c}{\PYZsh{} Test spread for stationarity with ADF assuming maxlag=1}
         \PY{n}{my\PYZus{}res\PYZus{}adf} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{nc}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Validate result with statsmodels}
         \PY{n}{sm\PYZus{}res\PYZus{}adf} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{nc}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
         
         \PY{k}{print} \PY{n}{sm\PYZus{}res\PYZus{}adf}
         \PY{k}{print} \PY{n}{my\PYZus{}res\PYZus{}adf}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{adfstat}\PY{l+s}{\PYZsq{}}\PY{p}{]}
         \PY{c}{\PYZsh{} print \PYZdq{}\PYZpc{}0.4f\PYZdq{} \PYZpc{} my\PYZus{}res\PYZus{}adf[\PYZsq{}adfstat\PYZsq{}]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
(-12.050868021596958, 5.7204620264072049e-22, \{'5\%': -1.9421357293965669, '1\%': -2.5748142943548387, '10\%': -1.6157914965824409\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000001012D710>)
-12.0508680216
    \end{Verbatim}

    \subsection{Error Correction Model
(ECM)}\label{error-correction-model-ecm}

Cointegration implies the existence of an Error Correction Model (ECM),
which provides an adjustment to the long-run equilibrium from the
short-run dynamics. This is particularly useful when modelling
non-stationary series, like market prices, which can lead to spurious
regression results.

Suppose the cointegrated pair is represented by \$\mathbf{Y}\_t = (y\_t,
x\_t)\^{}\prime \$. One can arrive at the ECM result as follows:

\begin{itemize}
\tightlist
\item
  Consider a dynamic regression model to allow for a wide variety of
  dynamic patterns in the data. This is done by including lags for both
  \(x_t\) and \(y_t\):
\end{itemize}

\[
y_t = \alpha y_{t-1} +  \beta_0 + \beta_1 x_t + \beta_2 x_{t-1} + \epsilon_t
\]

\begin{itemize}
\item
  By knowing the above equation should be consistent with the long-run
  equilibrium model \(y_t = b_0 + b_1 x_t + e_t\), it can be rewritten
  as:

  \[
  \Delta y_{t} = \beta_1 \Delta x_t - (1- \alpha) e_{t-1} + \epsilon_t
  \]

  where \(e_{t-1}\) is the lagged cointegrating spread from the
  equilbrium model. The parameter \(-(1-\alpha)\) is interpreted as the
  speed of correction towards the equilibrium level (more detais on next
  section)
\item
  Since all the variables in the ECM are I(0), OLS can be used to
  estimate the parameters
\end{itemize}

    \subsection{Quality of mean-reversion}\label{quality-of-mean-reversion}

If the cointegrating spread \(e_t\) is stationary, we could use the OU
process to model it:

\[
d e_t = \theta (\mu_e - e_t) dt + \sigma dW
\]

In discrete time this can be written as:

\[ 
\begin{equation}
\Delta e_t = \alpha \mu_e - \alpha e_{t-1} + \epsilon_{t, \tau}
\end{equation}
\]

where \(\alpha= 1 - e^{-\theta \tau}\) and \(\tau\) is a small period of
time. This is in fact the implied ECM representation for \(e_t\). As
disussed in the Appendix, the above equation can be written in it's
AR(1) representation as:

\[
e_t = \alpha \mu_e + (1-\alpha)e_{t-1} + \epsilon_{t, \tau}
\]

Rewriting in terms of \(C = \alpha \mu_e\) and \(B=1-\alpha\) we see it
is a simple regression which can be determined with OLS:

\[ 
\begin{equation}
e_t = C + B e_{t-1} + \epsilon_{t, \tau} \\
\end{equation}
\]

In particular, to assess the quality of the spread for trading
strategies the parameters of interest are:

\[
\theta = -\frac{\ln B}{\tau} \qquad \mu_e = \frac{C}{1-B} 
\quad \sigma_{OU} = \sqrt{\frac{2 \theta}{1-e^{-2\theta \tau}} Var[\epsilon_{t, \tau}]}
\]

\begin{itemize}
\item
  \(\mu_e\) is the long-run equilibrium level of the OU process
\item
  The mean-reversion speed \(\theta\) can be translated into a half-life
  \$\tilde{\tau} \propto \ln 2 / \theta \$, which is the time between
  equilibrium situations, i.e.~when \(e_t = \mu_e\). Hence, a high
  \(\theta\) (small \(\tilde{\tau}\)) is desirable to trigger trading
  signals
\item
  The standard deviation defined as
  \(\sigma_{eq} = \sigma_{OU} / \sqrt{2 \theta}\) can be used to plot
  trading bounds for entry/exit signals as \(\mu_e \pm \sigma_{eq}\)
\item
  Here we use \(\tau = 1/252\) given our data has daily frequency and
  the in-sample period covers 1 trading year i.e. \(\sim 252\) trading
  days
\end{itemize}

    \subsection{Real Data Example}\label{real-data-example}

    We now proceed to apply the concepts discussed above to real data:

\begin{itemize}
\item
  We use the in-sample dataset for Brent crude and Gasoil (Jan-2014 to
  Dec-2014). The out-of-sample dataset is later used to backtest trading
  strategies
\item
  For now we assume Brent is the independent variable \(x_t\) and Gasoil
  the dependent variable \(y_t\), and later check if this is accurate
  via \emph{Granger's causality test}
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}65}]:} \PY{n}{x} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}  \PY{c}{\PYZsh{} explanatory variable (\PYZsq{}X\PYZsq{})}
         \PY{n}{y} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]}  \PY{c}{\PYZsh{} dependent variable (\PYZsq{}Y\PYZsq{})}
         \PY{k}{print} \PY{n}{x}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
         \PY{k}{print} \PY{n}{y}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Date
2014-01-02    107.78
2014-01-03    106.89
2014-01-06    106.73
2014-01-07    107.35
2014-01-08    107.15
Name: brent, dtype: float64
Date
2014-01-02    123.959732
2014-01-03    122.181208
2014-01-06    122.181208
2014-01-07    122.214765
2014-01-08    122.449664
Name: gasoil, dtype: float64
    \end{Verbatim}

    \subsubsection{Stationarity}\label{stationarity}

First we check the individual price series for unit root I(1) as we
would expect. We apply the ADF test using one lag only as recommended by
their PACF plot below. A drift term (constant) is also included in the
test. The results are summarised in the table below and support Brent
and Gasoil are I(1) processes whilst their differences are I(0).

    \begin{longtable}[c]{@{}llllll@{}}
\toprule
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
Series
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
ADF t-stat
\strut\end{minipage} &
\begin{minipage}[b]{0.19\columnwidth}\raggedright\strut
5\% Crit. Val.
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\raggedright\strut
p-value
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
Stationary
\strut\end{minipage} &
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Stable
\strut\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
\(x_t\) (Brent)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
3.5768
\strut\end{minipage} &
\begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
-2.8728
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
1.00
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
No
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
No
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
\(y_t\) (Gasoil)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
3.9374
\strut\end{minipage} &
\begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
-2.8728
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
1.00
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
No
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
No
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
\(\Delta x_t\)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-18.1437
\strut\end{minipage} &
\begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
-2.8728
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
2.49E-30
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
\(\Delta y_t\)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-18.9247
\strut\end{minipage} &
\begin{minipage}[t]{0.19\columnwidth}\raggedright\strut
-2.8728
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\raggedright\strut
0.00
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}66}]:} \PY{c}{\PYZsh{} ======  OPTIMAL LAG SELECTION FROM PACF  ======}
         
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.graphics.tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}pacf}
         \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
         \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{n}{s\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{]}
         
         \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{s} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{s\PYZus{}list}\PY{p}{)}\PY{p}{:}
             \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
             \PY{n}{fig} \PY{o}{=} \PY{n}{plot\PYZus{}pacf}\PY{p}{(}\PY{n}{s}\PY{p}{,} \PY{n}{lags}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{l+m+mf}{40.5}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+m+mf}{0.85}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{n}{s}\PY{o}{.}\PY{n}{name}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{xx\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZdq{}}\PY{p}{)}
         \PY{c}{\PYZsh{}     if i \PYZlt{} 3:  \PYZsh{} set ticks to invisible}
         \PY{c}{\PYZsh{}         plt.xticks([])}
         \PY{c}{\PYZsh{}     if i == 1:}
         \PY{c}{\PYZsh{}         plt.ylabel(\PYZdq{}Correlation\PYZdq{})}
             \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{s\PYZus{}list}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{:}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{Lag}\PY{l+s}{\PYZdq{}}\PY{p}{)}    
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_51_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}67}]:} \PY{c}{\PYZsh{} ======  ADF TEST ON I(1) SERIES  ======}
         
         \PY{n}{my\PYZus{}result} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}  \PY{c}{\PYZsh{} result using my implementation}
         \PY{n}{sm\PYZus{}result} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}  \PY{c}{\PYZsh{} statsmodels result}
         
         \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{s} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{s\PYZus{}list}\PY{p}{)}\PY{p}{:}
             \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{s}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{s}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{s}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{s}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
             \PY{c}{\PYZsh{} Also do it for the differences, note different lag used}
             \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{d}\PY{l+s}{\PYZsq{}} \PY{o}{+} \PY{n}{s}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{s}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{)}
             \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{d}\PY{l+s}{\PYZsq{}} \PY{o}{+} \PY{n}{s}\PY{o}{.}\PY{n}{name}\PY{p}{]} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{s}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Print results}
         \PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{my\PYZus{}result}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}0\PYZcb{}: \PYZob{}1:.4f\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{adfstat}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{k}{print} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}
             \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{pvalue=}\PY{l+s+si}{\PYZpc{}0.4g}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{sm\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
dbrent: -18.1437
(-18.143719264743723, 2.4867756476974896e-30, \{'5\%': -2.8728972266578676, '1\%': -3.4561550092339512, '10\%': -2.5728222369384763\}, <statsmodels.tsa.stattools.ResultsStore object at 0x0000000012CAE748>)
pvalue=2.487e-30
dgasoil: -18.9247
(-18.924720011933648, 0.0, \{'5\%': -2.8728972266578676, '1\%': -3.4561550092339512, '10\%': -2.5728222369384763\}, <statsmodels.tsa.stattools.ResultsStore object at 0x0000000012C72F98>)
pvalue=0
brent: 3.5768
(3.5767945729466528, 1.0, \{'5\%': -2.8728972266578676, '1\%': -3.4561550092339512, '10\%': -2.5728222369384763\}, <statsmodels.tsa.stattools.ResultsStore object at 0x000000001313E160>)
pvalue=1
gasoil: 3.9374
(3.9373561613700625, 1.0, \{'5\%': -2.8728972266578676, '1\%': -3.4561550092339512, '10\%': -2.5728222369384763\}, <statsmodels.tsa.stattools.ResultsStore object at 0x0000000013134AC8>)
pvalue=1
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}68}]:} \PY{c}{\PYZsh{} ======  STABILITY CHECK  ======}
         
         \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{is\PYZus{}stable}
         
         \PY{k}{for} \PY{n}{key} \PY{o+ow}{in} \PY{n}{my\PYZus{}result}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
         \PY{c}{\PYZsh{}     print key, my\PYZus{}result[key][\PYZsq{}roots\PYZsq{}], sm\PYZus{}result[key][3].roots}
             \PY{k}{print} \PY{n}{key}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZob{}0\PYZcb{} passes stability check: \PYZob{}1\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n}{is\PYZus{}stable}\PY{p}{(}\PY{n}{my\PYZus{}result}\PY{p}{[}\PY{n}{key}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
dbrent [ 1.13645384  4.02521074]
dbrent passes stability check: True
dgasoil [ 1.11295032  3.67944752]
dgasoil passes stability check: True
brent [ 0.7871362   0.7871362   0.84225308]
brent passes stability check: False
gasoil [ 0.71964521  0.71964521  0.77280026]
gasoil passes stability check: False
    \end{Verbatim}

    \subsubsection{Cointegration}\label{cointegration}

We then proceed to test whether the pair is cointegrated, using the
Engle-Granger two-step procedure previously described.

\begin{itemize}
\item
  The long-run equilibrium model is shown in the figure below. The OLS
  estimate was:

  \[
   \hat{y}_x = 16.3229 + 0.9699 x_t + \hat{e}_t
  \]

  with goodness-of-fit \(R^2=0.986\).
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{c}{\PYZsh{} ======  ENGLE\PYZhy{}GRANGER 2\PYZhy{}STEP METHOD  ======}
        
        \PY{c}{\PYZsh{} ===== STEP 1: GET SPREAD FROM OLS =====}
        
        \PY{c}{\PYZsh{} My OLS and ADF implementatin}
        \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{my\PYZus{}OLS}
        
        \PY{c}{\PYZsh{} Import statsmodels equivalents to validate results}
        \PY{k+kn}{from} \PY{n+nn}{statsmodels.tsa.tsatools} \PY{k+kn}{import} \PY{n}{add\PYZus{}constant}
        \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
        
        \PY{c}{\PYZsh{} Define variables}
        \PY{n}{x} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}  \PY{c}{\PYZsh{} explanatory variable (\PYZsq{}X\PYZsq{})}
        \PY{n}{y} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]}   \PY{c}{\PYZsh{} dependent variable (\PYZsq{}Y\PYZsq{})}
        
        \PY{c}{\PYZsh{} Do OLS}
        \PY{n}{x} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{x}\PY{p}{)}
        \PY{n}{my\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{my\PYZus{}OLS}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{x}\PY{p}{)}
        \PY{n}{sm\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{x}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} validate result with statsmodels}
        \PY{n}{x} \PY{o}{=} \PY{n}{x}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}  \PY{c}{\PYZsh{} remove the constant now that we\PYZsq{}re done}
        
        \PY{c}{\PYZsh{} Set values of estimated parameters}
        \PY{n}{c\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{n}{beta2\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
        \PY{c}{\PYZsh{} cointegration spread, should be == sm\PYZus{}res\PYZus{}ols.resid ==  my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}]}
        \PY{n}{e\PYZus{}t\PYZus{}hat} \PY{o}{=} \PY{n}{y} \PY{o}{\PYZhy{}} \PY{n}{c\PYZus{}hat} \PY{o}{\PYZhy{}} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{x}
        \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat}\PY{l+s}{\PYZsq{}}
        
        \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}params\PYZsq{}]}
        \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.params}
        \PY{c}{\PYZsh{} print e\PYZus{}t\PYZus{}hat.mean()}
        \PY{n}{sm\PYZus{}res\PYZus{}ols}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
        \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}].head()}
        \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.resid.head()}
        \PY{c}{\PYZsh{} print e\PYZus{}t\PYZus{}hat.head()}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}8}]:} <class 'statsmodels.iolib.summary2.Summary'>
        """
                          Results: Ordinary least squares
        ==================================================================
        Model:              OLS              Adj. R-squared:     0.986    
        Dependent Variable: gasoil           AIC:                998.0839 
        Date:               2016-07-23 17:33 BIC:                1005.1898
        No. Observations:   258              Log-Likelihood:     -497.04  
        Df Model:           1                F-statistic:        1.846e+04
        Df Residuals:       256              Prob (F-statistic): 1.25e-240
        R-squared:          0.986            Scale:              2.7814   
        --------------------------------------------------------------------
                   Coef.    Std.Err.      t       P>|t|     [0.025    0.975]
        --------------------------------------------------------------------
        const     16.3229     0.7174    22.7540   0.0000   14.9102   17.7356
        brent      0.9699     0.0071   135.8850   0.0000    0.9558    0.9839
        ------------------------------------------------------------------
        Omnibus:              1.331         Durbin-Watson:           0.350
        Prob(Omnibus):        0.514         Jarque-Bera (JB):        1.346
        Skew:                 -0.172        Prob(JB):                0.510
        Kurtosis:             2.917         Condition No.:           694  
        ==================================================================
        
        """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}71}]:} \PY{c}{\PYZsh{} ===== PLOT OLS FIT  =====}
         
         \PY{c}{\PYZsh{} generate equally spaced X values between true X range}
         \PY{n}{x\PYZus{}dummy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{x}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{x}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
         
         \PY{c}{\PYZsh{} Plot the estimated dependent variable}
         \PY{n}{y\PYZus{}hat} \PY{o}{=} \PY{n}{c\PYZus{}hat} \PY{o}{+} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{x\PYZus{}dummy}
         
         \PY{c}{\PYZsh{} Plot own fit on top of seaborn scatter + fit}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cointegrating regression \PYZhy{} Brent \PYZam{} Gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{sns}\PY{o}{.}\PY{n}{regplot}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{,} \PY{n}{fit\PYZus{}reg}\PY{o}{=}\PY{n+nb+bp}{False}\PY{p}{)}  \PY{c}{\PYZsh{} true values}
         \PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{x\PYZus{}dummy}\PY{p}{,} \PY{n}{y\PYZus{}hat}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{r}\PY{l+s}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{OLS fit}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{real data}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}71}]:} <matplotlib.legend.Legend at 0x114d9588>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_56_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{itemize}
\item
  The estimated cointegrating spread \(\hat{e}_t\) series, histogram and
  PACF are shown below. First the mean of \(\hat{e}_t\) is for all
  practical purposes zero (\(\sim10^{-13}\)).
\item
  We also want \(\hat{e}_t\) to be normally distributed. The histogram
  below shows the spread distribution fitted to a normal distribution
  with \(\mu \sim 0\) and \(\sigma=1.66\). Two tests (\emph{Lilliefors}
  and \emph{Anderson-Darling}, see
  \href{http://statsmodels.sourceforge.net/notebooks/generated/statsmodels.stats.diagnostic.normal_ad.html}{ref1}
  and
  \href{http://statsmodels.sourceforge.net/devel/generated/statsmodels.stats.diagnostic.kstest_normal.html}{ref2})
  were carried to assess the goodness of fit and neither rejected the
  null hypothesis that \(\hat{e}_t\) is normally distributed
\item
  Next, we note that the PACF plot shows a peculiarity of this spread -
  it seems to have an AR(3) `memory', given the first three lags appear
  significant. Memory in the cointegrating spread is actually \emph{not
  desirable} because it will interfere with both mean-reversion and
  diffusion components of the OU process. One hypothesis is that this
  has an `economic explanation' in terms of commodity pricing,
  cyclicality or storage (e.g.~asset can't dramatically drop because
  there are storage/delivery ``carry'' costs borne by the sellers)
\item
  Next, \(\hat{e}_t\) was tested for stationarity using the CADF test.
  Since \(\hat{\mu}_e \sim 0\) the test was implemented without a
  constant or trend. Also, as suggested by the PACF plot, the test was
  ran with 3 lags. The results below show stationary could only be
  confirmed at the 95\% C.L.
\end{itemize}

    \begin{longtable}[c]{@{}lllllll@{}}
\toprule
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Series
\strut\end{minipage} &
\begin{minipage}[b]{0.15\columnwidth}\raggedright\strut
ADF t-stat
\strut\end{minipage} &
\begin{minipage}[b]{0.18\columnwidth}\raggedright\strut
5\% Crit. Val.
\strut\end{minipage} &
\begin{minipage}[b]{0.18\columnwidth}\raggedright\strut
1\% Crit. Val.
\strut\end{minipage} &
\begin{minipage}[b]{0.11\columnwidth}\raggedright\strut
p-value
\strut\end{minipage} &
\begin{minipage}[b]{0.31\columnwidth}\raggedright\strut
Stationary (95\% C.L.)
\strut\end{minipage} &
\begin{minipage}[b]{0.10\columnwidth}\raggedright\strut
Stable
\strut\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
\(\hat{e}_t\)
\strut\end{minipage} &
\begin{minipage}[t]{0.15\columnwidth}\raggedright\strut
-2.2335
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-1.9421
\strut\end{minipage} &
\begin{minipage}[t]{0.18\columnwidth}\raggedright\strut
-2.5746
\strut\end{minipage} &
\begin{minipage}[t]{0.11\columnwidth}\raggedright\strut
0.0245
\strut\end{minipage} &
\begin{minipage}[t]{0.31\columnwidth}\raggedright\strut
Yes
\strut\end{minipage} &
\begin{minipage}[t]{0.10\columnwidth}\raggedright\strut
Yes
\strut\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}109}]:} \PY{c}{\PYZsh{} ===== SPREAD PLOTS  =====}
          
          \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k+kn}{import} \PY{n}{gridspec}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}
          \PY{c}{\PYZsh{} gs = gridspec.GridSpec(2, 1, height\PYZus{}ratios=[3, 1])}
          \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{height\PYZus{}ratios}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mf}{0.5}\PY{p}{,} \PY{l+m+mf}{0.5}\PY{p}{]}\PY{p}{)}
          
          \PY{c}{\PYZsh{} === SPREAD TIME SERIES ===}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Cointegrating spread \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{} (Brent \PYZam{} Gasoil)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)} \PY{c}{\PYZsh{} Add the mean}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{mean=\PYZob{}0:0.2g\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{c}{\PYZsh{} === SPREAD HISTOGRAM ===}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
          
          \PY{k+kn}{from} \PY{n+nn}{scipy} \PY{k+kn}{import} \PY{n}{stats}
          
          \PY{n}{ax} \PY{o}{=} \PY{n}{sns}\PY{o}{.}\PY{n}{distplot}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{bins}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{kde}\PY{o}{=}\PY{n+nb+bp}{False}\PY{p}{,} \PY{n}{fit}\PY{o}{=}\PY{n}{stats}\PY{o}{.}\PY{n}{norm}\PY{p}{)}\PY{p}{;}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Distribution of Cointegrating Spread for Brent and Gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Get the fitted parameters used by sns}
          \PY{p}{(}\PY{n}{mu}\PY{p}{,} \PY{n}{sigma}\PY{p}{)} \PY{o}{=} \PY{n}{stats}\PY{o}{.}\PY{n}{norm}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}
          \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{mu=\PYZob{}0\PYZcb{}, sigma=\PYZob{}1\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{mu}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Legend and labels }
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{normal dist. fit (\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{mu }\PY{l+s}{\PYZbs{}}\PY{l+s}{sim\PYZdl{}\PYZob{}0\PYZcb{}, \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{sigma=\PYZdl{}\PYZob{}1:.2f\PYZcb{})}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{sigma}\PY{p}{)}\PY{p}{,}
                      \PY{l+s}{\PYZdq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZdq{}}
                     \PY{p}{]}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Value}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Frequency}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{c}{\PYZsh{} \PYZsh{} Cross\PYZhy{}check this is indeed the case \PYZhy{} should be overlaid over black curve}
          \PY{c}{\PYZsh{} x\PYZus{}dummy = np.linspace(stats.norm.ppf(0.01), stats.norm.ppf(0.99), 100)}
          \PY{c}{\PYZsh{} ax.plot(x\PYZus{}dummy, stats.norm.pdf(x\PYZus{}dummy, mu, sigma))}
          \PY{c}{\PYZsh{} plt.legend([\PYZdq{}normal dist. fit (\PYZdl{}\PYZbs{}mu=\PYZdl{}\PYZob{}0:.2g\PYZcb{}, \PYZdl{}\PYZbs{}sigma=\PYZdl{}\PYZob{}1:.2f\PYZcb{})\PYZdq{}.format(mu, sigma),}
          \PY{c}{\PYZsh{}            \PYZdq{}cross\PYZhy{}check\PYZdq{}])}
          
          \PY{c}{\PYZsh{} === SPREAD PACF ===}
          
          \PY{k+kn}{from} \PY{n+nn}{statsmodels.graphics.tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}pacf}
          
          \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
          \PY{n}{plot\PYZus{}pacf}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{lags}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Lags}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{PACF}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{c}{\PYZsh{} plt.text(x=40.5, y=0.85, s=\PYZsq{}PACF\PYZsq{}, size=\PYZsq{}xx\PYZhy{}large\PYZsq{})}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
mu=2.12116284916e-13, sigma=1.66126722372
    \end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}109}]:} <matplotlib.text.Text at 0x2338ed30>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_59_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}110}]:} \PY{c}{\PYZsh{} ===== GOODNESS OF FIT OF SPREAD TO NORM  ======}
          
          \PY{c}{\PYZsh{} Note: do not use scipy\PYZsq{}s kstest, }
          \PY{c}{\PYZsh{} see http://stackoverflow.com/questions/7903977/implementing\PYZhy{}a\PYZhy{}kolmogorov\PYZhy{}smirnov\PYZhy{}test\PYZhy{}in\PYZhy{}python\PYZhy{}scipy}
          
          \PY{k+kn}{import} \PY{n+nn}{statsmodels.api} \PY{k+kn}{as} \PY{n+nn}{sm}
          
          \PY{c}{\PYZsh{} Lilliefors test http://en.wikipedia.org/wiki/Lilliefors\PYZus{}test}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{Lilliefors:}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{sm}\PY{o}{.}\PY{n}{stats}\PY{o}{.}\PY{n}{lillifors}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Most Monte Carlo studies show that the Anderson\PYZhy{}Darling test is more powerful }
          \PY{c}{\PYZsh{} than the Kolmogorov\PYZhy{}Smirnov test. It is available in scipy.stats with critical values,}
          \PY{c}{\PYZsh{} and in statsmodels with approximate p\PYZhy{}values:}
          
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{Anderson\PYZhy{}Darling:}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{sm}\PY{o}{.}\PY{n}{stats}\PY{o}{.}\PY{n}{normal\PYZus{}ad}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Lilliefors: (0.038367676150135144, 0.43182566478813023)
Anderson-Darling: (0.32068246831158831, 0.52946233470021808)
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}111}]:} \PY{c}{\PYZsh{} ===== STEP 2: ADF TEST ON SPREAD  =====}
          
          \PY{c}{\PYZsh{} Test spread for stationarity with ADF assuming maxlag=1, no constant and no trend}
          \PY{n}{my\PYZus{}res\PYZus{}adf} \PY{o}{=} \PY{n}{my\PYZus{}adfuller}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{nc}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Validate result with statsmodels equivalent}
          \PY{n}{sm\PYZus{}res\PYZus{}adf} \PY{o}{=} \PY{n}{adfuller}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{regression}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{nc}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{autolag}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{regresults}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
          
          \PY{k}{print} \PY{n}{sm\PYZus{}res\PYZus{}adf}
          \PY{k}{print} \PY{n}{my\PYZus{}res\PYZus{}adf}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{adfstat}\PY{l+s}{\PYZsq{}}\PY{p}{]}
          \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s+si}{\PYZpc{}0.4f}\PY{l+s}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{my\PYZus{}res\PYZus{}adf}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{adfstat}\PY{l+s}{\PYZsq{}}\PY{p}{]}
          
          \PY{c}{\PYZsh{} ===== STABILITY CHECK  =====}
          \PY{k}{print} \PY{n}{key}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{my\PYZus{}res\PYZus{}adf}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
          \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s}{passes stability check: \PYZob{}0\PYZcb{}}\PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{is\PYZus{}stable}\PY{p}{(}\PY{n}{my\PYZus{}res\PYZus{}adf}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
(-2.2334740447616901, 0.024528788635871136, \{'5\%': -1.9421077325749141, '1\%': -2.5745985808171614, '10\%': -1.6158148499865503\}, <statsmodels.tsa.stattools.ResultsStore object at 0x00000000174E6D68>)
-2.23347404476
-2.2335
gasoil [ 1.26791578  1.26791578  4.92804523  8.47920813]
passes stability check: True
    \end{Verbatim}

    \subsubsection{ECM}\label{ecm}

The corresponding ECM adjustment was determined to be:

\[
\begin{array}{ccc}
\Delta y_{t}  = & -0.0861 + & 0.6455 \Delta x_t -0.1623 e_{t-1} + \epsilon_t \qquad \mathrm{(with~constant,~R^2=0.407)} \\
\Delta y_{t}  = & & 0.6596 \Delta x_t -0.1633 e_{t-1} + \epsilon_t
\qquad \mathrm{(no~constant, ~R^2=0.422)}
\end{array}
\]

This represents the second-order adjustment to the price, which as we
see is quite significant.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}124}]:} \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
          
          \PY{n}{Y} \PY{o}{=} \PY{n}{y}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}  \PY{c}{\PYZsh{} must remove first element from array which is nan}
          \PY{n}{X} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{[}\PY{n}{x}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{shift}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
          \PY{n}{X\PYZus{}c} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{X}\PY{p}{)}
          
          \PY{n}{sm\PYZus{}res\PYZus{}ecm} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{Y}\PY{p}{,} \PY{n}{X}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} fit without constant}
          \PY{n}{sm\PYZus{}res\PYZus{}ecm\PYZus{}c} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{Y}\PY{p}{,} \PY{n}{X\PYZus{}c}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} fit without constant}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}126}]:} \PY{n}{sm\PYZus{}res\PYZus{}ecm\PYZus{}c}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}126}]:} <class 'statsmodels.iolib.summary2.Summary'>
          """
                           Results: Ordinary least squares
          =================================================================
          Model:              OLS              Adj. R-squared:     0.407   
          Dependent Variable: gasoil           AIC:                665.1503
          Date:               2016-07-22 15:52 BIC:                675.7975
          No. Observations:   257              Log-Likelihood:     -329.58 
          Df Model:           2                F-statistic:        88.92   
          Df Residuals:       254              Prob (F-statistic): 5.33e-30
          R-squared:          0.412            Scale:              0.77001 
          -------------------------------------------------------------------
                     Coef.    Std.Err.      t      P>|t|     [0.025    0.975]
          -------------------------------------------------------------------
          const     -0.0861     0.0556   -1.5468   0.1232   -0.1957    0.0235
          brent      0.6455     0.0508   12.7195   0.0000    0.5456    0.7455
          e\_t\_hat   -0.1623     0.0332   -4.8877   0.0000   -0.2277   -0.0969
          -----------------------------------------------------------------
          Omnibus:              12.768       Durbin-Watson:          2.630 
          Prob(Omnibus):        0.002        Jarque-Bera (JB):       30.298
          Skew:                 0.056        Prob(JB):               0.000 
          Kurtosis:             4.678        Condition No.:          2     
          =================================================================
          
          """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}125}]:} \PY{n}{sm\PYZus{}res\PYZus{}ecm}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}125}]:} <class 'statsmodels.iolib.summary2.Summary'>
          """
                           Results: Ordinary least squares
          =================================================================
          Model:              OLS              Adj. R-squared:     0.422   
          Dependent Variable: gasoil           AIC:                665.5599
          Date:               2016-07-22 15:52 BIC:                672.6580
          No. Observations:   257              Log-Likelihood:     -330.78 
          Df Model:           2                F-statistic:        94.91   
          Df Residuals:       255              Prob (F-statistic): 1.55e-31
          R-squared:          0.427            Scale:              0.77422 
          -------------------------------------------------------------------
                     Coef.    Std.Err.      t      P>|t|     [0.025    0.975]
          -------------------------------------------------------------------
          brent      0.6596     0.0501   13.1761   0.0000    0.5610    0.7582
          e\_t\_hat   -0.1633     0.0333   -4.9060   0.0000   -0.2288   -0.0977
          -----------------------------------------------------------------
          Omnibus:              12.488       Durbin-Watson:          2.613 
          Prob(Omnibus):        0.002        Jarque-Bera (JB):       29.020
          Skew:                 0.064        Prob(JB):               0.000 
          Kurtosis:             4.641        Condition No.:          2     
          =================================================================
          
          """
\end{Verbatim}
        
    \subsubsection{Quality of
mean-reversion}\label{quality-of-mean-reversion}

    Given the peculiar PACF of \(\hat{e}_t\), which suggests it is an AR(3)
process, fitting to the OU process, which is an AR(1) process, might not
be suitable. We proceed nevertheless to compare the results between both
fits. For AR(3) we take the OU parameters as for AR(1): the constant
term equals \(\alpha \mu_e\) and the coefficient of the \(e_{t-1}\) term
is \(\alpha = 1 - e^{-\theta \tau}\). The table below shows the results
obtained, where we see the trading bounds are:

\[
 \mu_e \pm \sigma_{eq} =
  \begin{cases}
    -0.1255 \pm  1.6541 & \quad \text{AR(1)} \\
    -0.0529 \pm  0.8820  & \quad \text{AR(3)}\\
  \end{cases}
\]

The AR(3) fit yields a lower standard error in \(\theta\) than AR(1),
although not by much and yet the \(\theta\) values are quite different.
This perhaps indicates the OU fit is not suitable regardless of the lag
order.

    \begin{longtable}[c]{@{}ccccccc@{}}
\toprule
\begin{minipage}[b]{0.11\columnwidth}\centering\strut
Process
\strut\end{minipage} &
\begin{minipage}[b]{0.12\columnwidth}\centering\strut
\(\theta\)
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\centering\strut
\(\tilde{\tau}\)
\strut\end{minipage} &
\begin{minipage}[b]{0.11\columnwidth}\centering\strut
\(\mu_e\)
\strut\end{minipage} &
\begin{minipage}[b]{0.12\columnwidth}\centering\strut
\(\sigma_{OU}\)
\strut\end{minipage} &
\begin{minipage}[b]{0.11\columnwidth}\centering\strut
\(\sigma_{eq}\)
\strut\end{minipage} &
\begin{minipage}[b]{0.13\columnwidth}\centering\strut
\(s.e._\theta\)
\strut\end{minipage}\tabularnewline
\midrule
\endhead
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
AR(1)
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\centering\strut
49.1253
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\centering\strut
0.0141
\strut\end{minipage} &
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
-0.1255
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\centering\strut
16.3957
\strut\end{minipage} &
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
1.6541
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\centering\strut
7.3850
\strut\end{minipage}\tabularnewline
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
AR(3)
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\centering\strut
258.9327
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\centering\strut
0.0027
\strut\end{minipage} &
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
-0.0529
\strut\end{minipage} &
\begin{minipage}[t]{0.12\columnwidth}\centering\strut
20.0723
\strut\end{minipage} &
\begin{minipage}[t]{0.11\columnwidth}\centering\strut
0.8820
\strut\end{minipage} &
\begin{minipage}[t]{0.13\columnwidth}\centering\strut
5.6638
\strut\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}295}]:} \PY{c}{\PYZsh{} ======  FIT TO OU PROCESS  ======}
          
          \PY{c}{\PYZsh{} My implementations}
          \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{my\PYZus{}AR}  \PY{c}{\PYZsh{} AR(p) model}
          
          \PY{c}{\PYZsh{} Import statsmodels equivalents to validate results}
          \PY{k+kn}{from} \PY{n+nn}{statsmodels.tsa.ar\PYZus{}model} \PY{k+kn}{import} \PY{n}{AR}
          
          \PY{c}{\PYZsh{} Run AR(1) model with constant term with e\PYZus{}t\PYZus{}hat as endogenous variable}
          \PY{n}{my\PYZus{}res\PYZus{}ar} \PY{o}{=} \PY{n}{my\PYZus{}AR}\PY{p}{(}\PY{n}{endog}\PY{o}{=}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{trend}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{sm\PYZus{}res\PYZus{}ar} \PY{o}{=} \PY{n}{AR}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{trend}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{method}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cmle}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Stability Check}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{is AR(\PYZob{}0\PYZcb{}) model stable: \PYZob{}1\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{k\PYZus{}ar}\PY{p}{,} \PY{n}{is\PYZus{}stable}\PY{p}{(}\PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{roots}\PY{p}{)}\PY{p}{)}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{is AR(\PYZob{}0\PYZcb{}) model stable: \PYZob{}1\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{maxlag}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{is\PYZus{}stable}\PY{p}{(}\PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{roots}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
          
          \PY{c}{\PYZsh{} Cross\PYZhy{}checks}
          \PY{k}{print} \PY{l+s}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.params=\PYZob{}0\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) params=\PYZob{}1\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.llf=\PYZob{}2\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) llf=\PYZob{}3\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.nobs=\PYZob{}4\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) nobs=\PYZob{}5\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.cov\PYZus{}params(scale=ols\PYZus{}scale)=\PYZob{}6\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) cov\PYZus{}params=\PYZob{}7\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.bse=\PYZob{}8\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) bse=\PYZob{}9\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.tvalues=\PYZob{}10\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) tvalue=\PYZob{}11\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{AR(\PYZob{}12\PYZcb{}).fit.k\PYZus{}ar=\PYZob{}12\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{ MY\PYZus{}AR(\PYZob{}13\PYZcb{}) maxlag=\PYZob{}13\PYZcb{} }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}}
          \PY{l+s}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{params}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{llf}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{llf}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{nobs}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{nobs}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{cov\PYZus{}params}\PY{p}{(}\PY{n}{scale}\PY{o}{=}\PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{ols\PYZus{}scale}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{cov\PYZus{}params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{bse}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{bse}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{tvalues}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{tvalue}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
              \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{k\PYZus{}ar}\PY{p}{,} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{maxlag}\PY{l+s}{\PYZsq{}}\PY{p}{]}
          \PY{p}{)}
          
          \PY{c}{\PYZsh{} Get the fit errors}
          \PY{n}{ar1} \PY{o}{=} \PY{n}{AR}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{trend}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{method}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cmle}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{ar3} \PY{o}{=} \PY{n}{AR}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{maxlag}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{trend}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{c}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{method}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{cmle}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{c}{\PYZsh{} print ar1.bse}
          \PY{c}{\PYZsh{} print ar3.bse}
          
          \PY{c}{\PYZsh{} Standard error propagation in theta }
          \PY{c}{\PYZsh{} (using formula in https://en.wikipedia.org/wiki/Propagation\PYZus{}of\PYZus{}uncertainty\PYZsh{}Simplification )}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{theta s.e. AR(1) = \PYZob{}0:.4f\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mf}{1.}\PY{o}{/}\PY{n}{tau}\PY{o}{*}\PY{n}{my\PYZus{}B}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{p}{(}\PY{n}{ar1}\PY{o}{.}\PY{n}{bse}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{theta s.e. AR(3) = \PYZob{}0:.4f\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mf}{1.}\PY{o}{/}\PY{n}{tau}\PY{o}{*}\PY{n}{sm\PYZus{}B}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{*} \PY{p}{(}\PY{n}{ar3}\PY{o}{.}\PY{n}{bse}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
is AR(3) model stable: True
is AR(1) model stable: True
AR(3).fit.params=[-0.0339816   0.35789682  0.38033368  0.1825944 ] 
 MY\_AR(1) params=[-0.02222121  0.82288261] 
AR(3).fit.llf=-312.345856676 
 MY\_AR(1) llf=-348.732777659 
AR(3).fit.nobs=255 
 MY\_AR(1) nobs=257 
AR(3).fit.cov\_params(scale=ols\_scale)=[[  3.49496725e-03   1.12805807e-04  -6.65410304e-06  -1.15724490e-04]
 [  1.12805807e-04   5.09472635e-03  -2.19817515e-03  -2.39060283e-03]
 [ -6.65410304e-06  -2.19817515e-03   4.94828098e-03  -2.23751149e-03]
 [ -1.15724490e-04  -2.39060283e-03  -2.23751149e-03   5.06913477e-03]] 
 MY\_AR(1) cov\_params=[[  3.46441577e-03  -1.56281520e-05]
 [ -1.56281520e-05   1.26830769e-03]] 
AR(3).fit.bse=[ 0.05201268  0.06279833  0.0618892   0.06264041] 
 MY\_AR(1) bse=[ 0.05885929  0.03561331] 
AR(3).fit.tvalues=[-0.65333296  5.6991455   6.14539696  2.91496187] 
 MY\_AR(1) tvalue=[ -0.37753101  23.10604287] 
AR(3).fit.k\_ar=3 
 MY\_AR(1) maxlag=1 

theta s.e. AR(1) = 7.3850
theta s.e. AR(3) = 5.6638
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{tau} \PY{o}{=} \PY{l+m+mf}{1.} \PY{o}{/} \PY{l+m+mf}{252.}  \PY{c}{\PYZsh{} ok for daily frequency data}
         
         \PY{c}{\PYZsh{} AR(1)}
         \PY{n}{my\PYZus{}C} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{my\PYZus{}B} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
         \PY{n}{my\PYZus{}theta} \PY{o}{=} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{my\PYZus{}B}\PY{p}{)} \PY{o}{/} \PY{n}{tau}
         \PY{n}{my\PYZus{}mu\PYZus{}e} \PY{o}{=} \PY{n}{my\PYZus{}C} \PY{o}{/} \PY{p}{(}\PY{l+m+mf}{1.} \PY{o}{\PYZhy{}} \PY{n}{my\PYZus{}B}\PY{p}{)}
         \PY{n}{my\PYZus{}sigma\PYZus{}ou} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{my\PYZus{}theta} \PY{o}{/} \PY{p}{(}\PY{l+m+mi}{1} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{my\PYZus{}theta} \PY{o}{*} \PY{n}{tau}\PY{p}{)}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{sigma}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{my\PYZus{}sigma\PYZus{}e} \PY{o}{=} \PY{n}{my\PYZus{}sigma\PYZus{}ou} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{my\PYZus{}theta}\PY{p}{)}
         \PY{n}{my\PYZus{}halflife} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/} \PY{n}{my\PYZus{}theta}
         \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{ AR(\PYZob{}8\PYZcb{}): my\PYZus{}C=\PYZob{}0\PYZcb{}, my\PYZus{}B=\PYZob{}1\PYZcb{}, tau=\PYZob{}2\PYZcb{}, my\PYZus{}theta=\PYZob{}3\PYZcb{}, my\PYZus{}mu\PYZus{}e=\PYZob{}4\PYZcb{}, my\PYZus{}sigma\PYZus{}ou=\PYZob{}5\PYZcb{}, my\PYZus{}sigma\PYZus{}e=\PYZob{}6\PYZcb{}, my\PYZus{}halflife=\PYZob{}7:.4f\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{my\PYZus{}C}\PY{p}{,} 
                                                 \PY{n}{my\PYZus{}B}\PY{p}{,} 
                                                 \PY{n}{tau}\PY{p}{,}  
                                                 \PY{n}{my\PYZus{}theta}\PY{p}{,} 
                                                 \PY{n}{my\PYZus{}mu\PYZus{}e}\PY{p}{,}
                                                 \PY{n}{my\PYZus{}sigma\PYZus{}ou}\PY{p}{,}
                                                 \PY{n}{my\PYZus{}sigma\PYZus{}e}\PY{p}{,}
                                                 \PY{n}{my\PYZus{}halflife}\PY{p}{,}
                                                 \PY{n}{my\PYZus{}res\PYZus{}ar}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{maxlag}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         
         \PY{c}{\PYZsh{} AR(3)}
         \PY{n}{sm\PYZus{}C} \PY{o}{=} \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{sm\PYZus{}B} \PY{o}{=} \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
         \PY{n}{sm\PYZus{}theta} \PY{o}{=} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{sm\PYZus{}B}\PY{p}{)} \PY{o}{/} \PY{n}{tau}
         \PY{n}{sm\PYZus{}mu\PYZus{}e} \PY{o}{=} \PY{n}{sm\PYZus{}C} \PY{o}{/} \PY{p}{(}\PY{l+m+mf}{1.} \PY{o}{\PYZhy{}} \PY{n}{sm\PYZus{}B}\PY{p}{)}
         \PY{n}{sm\PYZus{}sigma\PYZus{}ou} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{sm\PYZus{}theta} \PY{o}{/} \PY{p}{(}\PY{l+m+mi}{1} \PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{sm\PYZus{}theta} \PY{o}{*} \PY{n}{tau}\PY{p}{)}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{sigma2}\PY{p}{)}
         \PY{n}{sm\PYZus{}sigma\PYZus{}e} \PY{o}{=} \PY{n}{sm\PYZus{}sigma\PYZus{}ou} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{l+m+mi}{2} \PY{o}{*} \PY{n}{sm\PYZus{}theta}\PY{p}{)}
         \PY{n}{sm\PYZus{}halflife} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)} \PY{o}{/} \PY{n}{sm\PYZus{}theta}
         \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{ AR(\PYZob{}8\PYZcb{}): sm\PYZus{}C=\PYZob{}0\PYZcb{}, sm\PYZus{}B=\PYZob{}1\PYZcb{}, tau=\PYZob{}2\PYZcb{}, sm\PYZus{}theta=\PYZob{}3\PYZcb{}, sm\PYZus{}mu\PYZus{}e=\PYZob{}4\PYZcb{}, sm\PYZus{}sigma\PYZus{}ou=\PYZob{}5\PYZcb{}, sm\PYZus{}sigma\PYZus{}e=\PYZob{}6\PYZcb{}, sm\PYZus{}halflife=\PYZob{}7:.4f\PYZcb{}}\PY{l+s}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{sm\PYZus{}C}\PY{p}{,}
             \PY{n}{sm\PYZus{}B}\PY{p}{,}
             \PY{n}{tau}\PY{p}{,}
             \PY{n}{sm\PYZus{}theta}\PY{p}{,}
             \PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,}
             \PY{n}{sm\PYZus{}sigma\PYZus{}ou}\PY{p}{,}
             \PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{,}
             \PY{n}{sm\PYZus{}halflife}\PY{p}{,}
             \PY{n}{sm\PYZus{}res\PYZus{}ar}\PY{o}{.}\PY{n}{k\PYZus{}ar}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
AR(1): my\_C=-0.0222212062071, my\_B=0.822882614599, tau=0.00396825396825, my\_theta=49.1253133355, my\_mu\_e=-0.125460333308, my\_sigma\_ou=16.3957293292, my\_sigma\_e=1.65410500427, my\_halflife=0.0141
 AR(3): sm\_C=-0.0339815972636, sm\_B=0.357896821164, tau=0.00396825396825, sm\_theta=258.932656877, sm\_mu\_e=-0.0529223314626, sm\_sigma\_ou=20.0722726051, sm\_sigma\_e=0.882039704225, sm\_halflife=0.0027
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}175}]:} \PY{c}{\PYZsh{} Equivalent to AR(1) model above but expressed using differences}
          
          \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
          
          \PY{n}{Y\PYZus{}e} \PY{o}{=} \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}  \PY{c}{\PYZsh{} de\PYZus{}t}
          \PY{n}{X\PYZus{}e} \PY{o}{=} \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{shift}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}  \PY{c}{\PYZsh{} e\PYZus{}t\PYZhy{}1}
          \PY{n}{X\PYZus{}e} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{X\PYZus{}e}\PY{p}{)}
          \PY{n}{r} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{Y\PYZus{}e}\PY{p}{,} \PY{n}{X\PYZus{}e}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}
          \PY{n}{X\PYZus{}e} \PY{o}{=} \PY{n}{X\PYZus{}e}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}  \PY{c}{\PYZsh{} remove the constant now that we\PYZsq{}re done}
          
          \PY{n}{r}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}175}]:} <class 'statsmodels.iolib.summary2.Summary'>
          """
                           Results: Ordinary least squares
          =================================================================
          Model:              OLS              Adj. R-squared:     0.085   
          Dependent Variable: e\_t\_hat          AIC:                701.4656
          Date:               2016-07-22 18:17 BIC:                708.5637
          No. Observations:   257              Log-Likelihood:     -348.73 
          Df Model:           1                F-statistic:        24.73   
          Df Residuals:       255              Prob (F-statistic): 1.21e-06
          R-squared:          0.088            Scale:              0.89031 
          -------------------------------------------------------------------
                     Coef.    Std.Err.      t      P>|t|     [0.025    0.975]
          -------------------------------------------------------------------
          const     -0.0222     0.0589   -0.3775   0.7061   -0.1381    0.0937
          e\_t\_hat   -0.1771     0.0356   -4.9733   0.0000   -0.2473   -0.1070
          -----------------------------------------------------------------
          Omnibus:              12.984       Durbin-Watson:          2.742 
          Prob(Omnibus):        0.002        Jarque-Bera (JB):       31.297
          Skew:                 0.050        Prob(JB):               0.000 
          Kurtosis:             4.707        Condition No.:          2     
          =================================================================
          
          """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}296}]:} \PY{c}{\PYZsh{} PLOTTING}
          
          \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{)}\PY{p}{)}
          \PY{c}{\PYZsh{} plt.plot(e\PYZus{}t\PYZus{}hat, label=\PYZsq{}\PYZdl{}\PYZbs{}hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}\PYZsq{})}
          
          \PY{c}{\PYZsh{} Trading bounds}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Trading bounds for Cointegrated Spread (Brent \PYZam{} Gasoil)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{grey}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}  \PY{c}{\PYZsh{} axis line}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{my\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{:}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{AR(1) OU \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{mu\PYZus{}e }\PY{l+s}{\PYZbs{}}\PY{l+s}{pm }\PY{l+s}{\PYZbs{}}\PY{l+s}{sigma\PYZus{}\PYZob{}eq\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{AR(3) OU \PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{mu\PYZus{}e }\PY{l+s}{\PYZbs{}}\PY{l+s}{pm }\PY{l+s}{\PYZbs{}}\PY{l+s}{sigma\PYZus{}\PYZob{}eq\PYZcb{}\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{my\PYZus{}sigma\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{:}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{my\PYZus{}sigma\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{:}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{lower right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}296}]:} <matplotlib.legend.Legend at 0x25b2fe80>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_72_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Granger Causality}\label{granger-causality}

When implementing the regression to estimate \(e_t\) an assumption must
be made about which the dependent variable is. This will also influence
the parameters estimates and test results.

Due to time constrains this was not self-implemented but used the python
statsmodels implementation.

    \section{Issues with Cointegration}\label{issues-with-cointegration}

\begin{itemize}
\tightlist
\item
  Johansen procedure - MLE for multivariate cointegration on asset price
  data (levels, not returns)
\end{itemize}

    \section{Trading Strategies}\label{trading-strategies}

    Below we describe a few strategies which exploit the cointegration
properties. It should be noted that it is actually very difficult to
find a directly tradable asset that possesses mean-reverting behaviour -
in practice this is instead achieved by creating a \emph{stationary
portfolio} of separately interrelated assets. For the demonstrations
below however, we remain with a the 2-asset portfolio from before: Brent
and Gasoil.

    \subsubsection{Regime changes}\label{regime-changes}

Tests for cointegration assume that the cointegrating vector is constant
during the period of study. In reality, it is possible that the long-run
relationship between the underlying variables change (shifts in the
cointegrating vector can occur), e.g from changes in their
\emph{fundamental factors}. This is especially likely to be the case if
the sample period is long. Hence, it shouldn't be assumed that because
the assets have passed a cointegration test historically, they will
continue to remain cointegrated. Practicioner's advice is to estimate
using one year of historic data and trade the estimates for a 6-month
period.

This is then a good introduction to the next topic, which is
Backtesting.

    \subsubsection{Backtesting}\label{backtesting}

Backtesting is the process of testing a trading strategy on historical
data to gauge its effectiveness. When we backtest a model, the results
achieved are highly dependent on the tested period and this can cause
the strategy to fail in the future, as regime changes or \emph{model
overfitting} could have taken place.

To alleviate this, the test data is usually split into \emph{in-sample}
and \emph{out-of-sample} data (a `rule-of-thumb' is an 80-20 split). The
model/strategy is then fitted/tested to the in-sample data \emph{only}
and then tested on the out-of-sample data, which has been `unseen'. This
process provides a better way to assess the \emph{true} performance of a
strategy.

    \subsection{Naive Beta-Hedging
Strategy}\label{naive-beta-hedging-strategy}

    ** Factor models** are a way of explaining the returns of one asset via
a linear combination of the returns of other assets. This can be
expressed as a simple linear regression:

\[\Delta Y = \alpha + \beta_1 \Delta X_1 + \beta_2 \Delta X_2 + \dots + \beta_n \Delta X_n + \epsilon_t \]

We can interpret the betas as the \emph{exposure} of asset \(Y\) to the
other assets and \(\alpha\) as the market-neutral excess return:

\[ \alpha = \mathrm{E}[\Delta Y - \beta_1 \Delta X_1 + \beta_2 \Delta X_2 + \dots + \beta_n \Delta X_n] \]

since \(\mathrm{E}[\epsilon_t] =0\).

For the case of Brent and Gasoil only this would be:

\[\Delta Y_{gasoil} = \alpha + \beta \Delta X_{brent} + \epsilon_t \]

We could take a short position in Brent equal to
\(\beta \Delta X_{brent}\) to try to eliminate the \emph{risk} in our
Gasoil position. Hence, we would expect our returns to be on average:

\[\mathrm{E} [\Delta Y_{gasoil} - \beta X_{brent}] = \alpha \]

For the \textbf{in-sample} data, running the above regression would
actually yield negative returns, although less severe than just going
long Gasoil:

\[
\begin{array}{rl}
\mathrm{E} [ \Delta Y_{gasoil}^{is}  -0.6282 \Delta X_{brent}^{is}] =  & \alpha   =  -0.0915 \qquad (R^2 = 0.354) \\
\mathrm{E} [ \Delta Y_{gasoil}^{is}]  =  & \alpha   =   
-0.2148  \qquad  \text{(no fit)}
\end{array}
\]

One problem could be that the estimated beta is not constant as we walk
forward in time. As such, the short position we took out in Brent is not
perfectly hedging our portfolio. Another is that additional factors or
assets should be included into the model.

Surprisingly, our performance in the \textbf{out-of-sample} seems to be
better but that was just mere `luck' from positive fluctuations in the
data, and still worse off than going long just Gasoil over this period:

\[
\begin{array}{rl}
\mathrm{E} [ \Delta Y_{gasoil}^{os}  -0.6282 \Delta X_{brent}^{os}] =  & \mathrm{E}[ \alpha_t]    = 0.02231 \qquad \text{(in-sample fit)}  \\
\mathrm{E} [ \Delta Y_{gasoil}^{os}] =   & \mathrm{E}[ \alpha_t]   =  0.05806  \qquad  \text{(no fit)}
\end{array}
\]

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}292}]:} \PY{c}{\PYZsh{} ======== BETA HEDGING ========}
          
          \PY{c}{\PYZsh{} === In\PYZhy{}sample fit ===}
          \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
          
          \PY{n}{Y\PYZus{}is} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}  \PY{c}{\PYZsh{} must remove first element from array which is nan}
          \PY{n}{X\PYZus{}is} \PY{o}{=} \PY{n}{df\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
          
          \PY{n}{X\PYZus{}is\PYZus{}c} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{X\PYZus{}is}\PY{p}{)}
          
          \PY{c}{\PYZsh{} res\PYZus{}bh = OLS(Y\PYZus{}is, X\PYZus{}is).fit()  \PYZsh{} fit without constant}
          \PY{n}{res\PYZus{}bh\PYZus{}c} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{Y\PYZus{}is}\PY{p}{,} \PY{n}{X\PYZus{}is\PYZus{}c}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} fit without constant}
          
          \PY{n}{res\PYZus{}bh\PYZus{}c}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}292}]:} <class 'statsmodels.iolib.summary2.Summary'>
          """
                           Results: Ordinary least squares
          =================================================================
          Model:              OLS              Adj. R-squared:     0.354   
          Dependent Variable: gasoil           AIC:                686.2518
          Date:               2016-07-23 13:41 BIC:                693.3499
          No. Observations:   257              Log-Likelihood:     -341.13 
          Df Model:           1                F-statistic:        141.3   
          Df Residuals:       255              Prob (F-statistic): 3.22e-26
          R-squared:          0.357            Scale:              0.83913 
          -------------------------------------------------------------------
                      Coef.    Std.Err.      t      P>|t|     [0.025   0.975]
          -------------------------------------------------------------------
          const      -0.0915     0.0581   -1.5751   0.1165   -0.2058   0.0229
          brent       0.6282     0.0529   11.8861   0.0000    0.5241   0.7323
          -----------------------------------------------------------------
          Omnibus:              18.669       Durbin-Watson:          2.853 
          Prob(Omnibus):        0.000        Jarque-Bera (JB):       61.678
          Skew:                 -0.026       Prob(JB):               0.000 
          Kurtosis:             5.399        Condition No.:          1     
          =================================================================
          
          """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}293}]:} \PY{c}{\PYZsh{} === In\PYZhy{}sample testing ===}
          \PY{k}{print} \PY{p}{(}\PY{n}{Y\PYZus{}is} \PY{o}{\PYZhy{}} \PY{n}{res\PYZus{}bh\PYZus{}c}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{n}{X\PYZus{}is}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} long gasoil, short brent}
          \PY{k}{print} \PY{p}{(}\PY{n}{Y\PYZus{}is}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} long gasoil only}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
-0.0914750485103
-0.214791215106
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}294}]:} \PY{c}{\PYZsh{} === Out\PYZhy{}of\PYZhy{}sample testing ===}
          \PY{n}{Y\PYZus{}os} \PY{o}{=} \PY{n}{df\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
          \PY{n}{X\PYZus{}os} \PY{o}{=} \PY{n}{df\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
          
          \PY{k}{print} \PY{p}{(}\PY{n}{Y\PYZus{}os} \PY{o}{\PYZhy{}} \PY{n}{res\PYZus{}bh\PYZus{}c}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{n}{X\PYZus{}os}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} long gasoil, short brent}
          \PY{k}{print} \PY{p}{(}\PY{n}{Y\PYZus{}os}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} long gasoil only}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
0.0223119372259
0.0580590177905
    \end{Verbatim}

    \subsection{Pairs Trading Strategy}\label{pairs-trading-strategy}

    Moving into a more sophisticated approach, we now apply the concepts of
cointegration learned. Although it is commonly referred as `pairs
trading', the concept applies to any stationary portfolio of assets.

For a pair of assets, if they are cointegrated e.g.~because they belong
to the same `sector', they are likely to be exposed to similar market
factors. Occasionally their relative prices will diverge due to certain
events, but eventually will revert to the long-run equilibrium. Hence,
positions are taken relative to where the \textbf{cointegrating spread
\(\hat{e}_t\)} is with respect to the equilibrium level. The objective
is to hedge the position from price level dynamics (market risk). The
P\&L generated will then be driven by the quality of mean-reversion.

For Gasoil and Brent, we estimated the \textbf{in-sample} cointegrating
relationship as:

\[
Y_{gasoil}^{is} = 0.9699 X_{brent}^{is}  + 16.3229 + \hat{e}_t^{is}
\]

Under the assumption that the relationship holds, we use the same beta
and constant to estimate the \textbf{out-of-sample} spread:

\[
\hat{e}_t^{os} = Y_{gasoil}^{os} - 0.9699 X_{brent}^{os}  - 16.3229 
\]

This is then what we use to \textbf{backtest} the strategy.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}206}]:} \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}.4f}\PY{l+s}{\PYZsq{}}  \PY{o}{\PYZpc{}} \PY{n}{c\PYZus{}hat}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}.4f}\PY{l+s}{\PYZsq{}}  \PY{o}{\PYZpc{}} \PY{n}{beta2\PYZus{}hat}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
16.3229
0.9699
    \end{Verbatim}

    \subsubsection{Bounds from OU process}\label{bounds-from-ou-process}

As we saw, we could define thresholds for trading the spread by fitting
to the OU process and using the fitted mean \(\mu_e\) and relative
standard deviation \(\sigma_{eq}\). Assuming normality of the spread
\(e_{t, \tau \to \infty} \sim N (\mu_e, \sigma^2_{eq})\), a z-score
could be used to `normalise' the spread:

\[
z = \frac{\hat{e}_t - \mu_e}{\sigma_{eq}}
\]

Given this, a simple strategy would then be:

\begin{itemize}
\item
  Go ``Long'' the spread when the z-score is below -1.0: this means
  longing \(Y_{gasoil}\) and shorting \(X_{brent}\)
\item
  Go ``Short'' the spread when the z-score is above 1.0: this means
  shorting \(Y_{gasoil}\) and longing \(X_{brent}\)
\item
  Exit positions when the z-score is within \([-0.1, 0.1]\) i.e.~near
  zero
\end{itemize}

The figure below shows the out-of-sample z-score spread with the AR(3)
OU entry/exit bounds (Eqn. X).

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}351}]:} \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(3) OU bounds}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sm\PYZus{}sigma\PYZus{}e}
          \PY{k}{print} \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(1) OU bounds}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{my\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{my\PYZus{}sigma\PYZus{}e}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
AR(3) OU bounds -0.0529223314626 0.882039704225
AR(1) OU bounds -0.125460333308 1.65410500427
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}215}]:} \PY{k}{def} \PY{n+nf}{static\PYZus{}zscore}\PY{p}{(}\PY{n}{series}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{)}\PY{p}{:}
              \PY{k}{if} \PY{p}{(}\PY{n}{mean} \PY{o}{!=} \PY{n+nb+bp}{None} \PY{o+ow}{and} \PY{n}{sigma} \PY{o}{!=} \PY{n+nb+bp}{None}\PY{p}{)}\PY{p}{:}
                  \PY{k}{return} \PY{p}{(}\PY{n}{series} \PY{o}{\PYZhy{}} \PY{n}{mean}\PY{p}{)} \PY{o}{/} \PY{n}{sigma}
              \PY{k}{else}\PY{p}{:}
                  \PY{k}{return} \PY{p}{(}\PY{n}{series} \PY{o}{\PYZhy{}} \PY{n}{series}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{series}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}216}]:} \PY{c}{\PYZsh{} ========= GENERATE P\PYZam{}L DATAFRAME FOR A GIVEN SPREAD =========}
          
          \PY{k}{def} \PY{n+nf}{get\PYZus{}pnl\PYZus{}df}\PY{p}{(}\PY{n}{spread}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n+nb+bp}{None}\PY{p}{)}\PY{p}{:}
              \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
          \PY{l+s+sd}{    Note the input spread must be zscore\PYZhy{}normalised}
          \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
              \PY{c}{\PYZsh{} normalise as z\PYZhy{}score}
              \PY{k}{if} \PY{p}{(}\PY{n}{mean} \PY{o}{!=} \PY{n+nb+bp}{None} \PY{o+ow}{and} \PY{n}{sigma} \PY{o}{!=} \PY{n+nb+bp}{None}\PY{p}{)}\PY{p}{:}
                  \PY{n}{spread\PYZus{}norm} \PY{o}{=} \PY{p}{(}\PY{n}{spread} \PY{o}{\PYZhy{}} \PY{n}{mean}\PY{p}{)} \PY{o}{/} \PY{n}{sigma}  
              \PY{k}{else}\PY{p}{:}  \PY{c}{\PYZsh{} if not provided with mean or sigma, then use the sample mean and std}
                  \PY{n}{spread\PYZus{}norm} \PY{o}{=} \PY{p}{(}\PY{n}{spread} \PY{o}{\PYZhy{}} \PY{n}{spread}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{spread}\PY{p}{)}
              \PY{n}{df\PYZus{}pnl\PYZus{}is} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{spread}\PY{o}{.}\PY{n}{index}\PY{p}{)}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{spread}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat\PYZus{}norm}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{spread\PYZus{}norm}
              \PY{c}{\PYZsh{} df\PYZus{}pnl\PYZus{}is[\PYZsq{}diff\PYZsq{}] = df\PYZus{}pnl\PYZus{}is[\PYZsq{}e\PYZus{}t\PYZus{}hat\PYZsq{}].diff()}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
              \PY{c}{\PYZsh{} Go long the spread when it is below \PYZhy{}1 as expectation is it will rise}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat\PYZus{}norm}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
              \PY{c}{\PYZsh{} Go short the spread when it is above +1 as expectation is it will fall}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat\PYZus{}norm}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{l+m+mf}{1.0}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
              \PY{c}{\PYZsh{} Exit positions when close to zero}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat\PYZus{}norm}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{l+m+mf}{0.1}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat\PYZus{}norm}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.1}\PY{p}{)}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
              \PY{c}{\PYZsh{} \PYZsh{} forward fill NaN\PYZsq{}s with previous value}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{n}{method}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{pad}\PY{l+s}{\PYZsq{}}\PY{p}{)}
              \PY{c}{\PYZsh{} Returns must be calculated in unnormalised spread}
              \PY{c}{\PYZsh{} \PYZhy{} adopting Boris convention with shift(\PYZhy{}1) (must shift after taking diff)}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{chg}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{shift}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
              \PY{c}{\PYZsh{} PnL}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pos}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{*} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{chg}\PY{l+s}{\PYZsq{}}\PY{p}{]}
              \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}
              
              \PY{k}{return} \PY{n}{df\PYZus{}pnl\PYZus{}is}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}299}]:} \PY{c}{\PYZsh{} ========= IN\PYZhy{}SAMPLE P\PYZam{}l =========}
          
          \PY{c}{\PYZsh{} e\PYZus{}t\PYZus{}hat is the in\PYZhy{}sample spread}
          \PY{n}{df\PYZus{}pnl\PYZus{}is} \PY{o}{=} \PY{n}{get\PYZus{}pnl\PYZus{}df}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{)}
          \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{o}{.}\PY{n}{tail}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}299}]:}              e\_t\_hat  e\_t\_hat\_norm  pos       chg       pnl    pnl\_cum
          Date                                                                  
          2014-12-24 -1.760881     -1.936374  1.0  0.128608  0.128608  31.408631
          2014-12-26 -1.632273     -1.790567  1.0  1.019330  1.019330  32.427960
          2014-12-29 -0.612944     -0.634916  1.0 -1.294565 -1.294565  31.133395
          2014-12-30 -1.907509     -2.102611  1.0 -1.259258 -1.259258  29.874137
          2014-12-31 -3.166767     -3.530277  1.0       NaN       NaN        NaN
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}306}]:} \PY{c}{\PYZsh{} ========= OUT\PYZhy{}OF\PYZhy{}SAMPLE P\PYZam{}l =========}
          
          \PY{c}{\PYZsh{} Construct the out\PYZhy{}of\PYZhy{}sample spread}
          \PY{n}{e\PYZus{}t\PYZus{}hat\PYZus{}os} \PY{o}{=} \PY{n}{df\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{c\PYZus{}hat} \PY{o}{\PYZhy{}} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{df\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}
          
          \PY{n}{df\PYZus{}pnl\PYZus{}os} \PY{o}{=} \PY{n}{get\PYZus{}pnl\PYZus{}df}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat\PYZus{}os}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{)}
          \PY{n}{df\PYZus{}pnl\PYZus{}os}\PY{o}{.}\PY{n}{tail}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}306}]:}              e\_t\_hat  e\_t\_hat\_norm  pos       chg       pnl    pnl\_cum
          Date                                                                  
          2015-06-24  0.087063      0.158706  1.0 -1.161693 -1.161693  40.100749
          2015-06-25 -1.074630     -1.158346  1.0  0.445164  0.445164  40.545913
          2015-06-26 -0.629466     -0.653648  1.0 -0.062839 -0.062839  40.483074
          2015-06-29 -0.692304     -0.724890  1.0 -0.290773 -0.290773  40.192301
          2015-06-30 -0.983078     -1.054550  1.0       NaN       NaN        NaN
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}301}]:} \PY{c}{\PYZsh{} ======== PLOT OUT\PYZhy{}OF\PYZhy{}SAMPLE Z\PYZhy{}SCORE ========}
          
          \PY{c}{\PYZsh{} Normalise to OU bounds}
          \PY{n}{normalised\PYZus{}e\PYZus{}t\PYZus{}hat\PYZus{}os} \PY{o}{=} \PY{n}{static\PYZus{}zscore}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat\PYZus{}os}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n}{sm\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{sm\PYZus{}sigma\PYZus{}e}\PY{p}{)}
          \PY{n}{normalised\PYZus{}e\PYZus{}t\PYZus{}hat\PYZus{}os}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{1.0}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{green}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZdl{}}\PY{l+s}{\PYZbs{}}\PY{l+s}{hat\PYZob{}e\PYZcb{}\PYZus{}t\PYZdl{}}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{+1}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}1}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{upper right}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{grey}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{AR(3) OU z\PYZhy{}score}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{Normalised Out\PYZhy{}of\PYZhy{}sample Cointegrated Spread }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{(Gasoil\PYZhy{}Brent)}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}301}]:} <matplotlib.text.Text at 0x2028e908>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_93_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The corresponding P\&L is shown below, for both the in-sample and
out-of-sample periods separated by the black dotted line. A positive
performance is observed in both, although there are prolonged drawdown
periods. In addition, note this doesn't include \textbf{transaction
costs} which could certainly add up to an overall loss.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}307}]:} \PY{c}{\PYZsh{} ======= P\PYZam{}L USING AR(1) BOUNDS INSTEAD OF AR(3) BOUNDS =======}
          \PY{n}{ar1\PYZus{}df\PYZus{}pnl\PYZus{}is} \PY{o}{=} \PY{n}{get\PYZus{}pnl\PYZus{}df}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n}{my\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{my\PYZus{}sigma\PYZus{}e}\PY{p}{)}
          \PY{n}{ar1\PYZus{}df\PYZus{}pnl\PYZus{}os} \PY{o}{=} \PY{n}{get\PYZus{}pnl\PYZus{}df}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat\PYZus{}os}\PY{p}{,} \PY{n}{mean}\PY{o}{=}\PY{n}{my\PYZus{}mu\PYZus{}e}\PY{p}{,} \PY{n}{sigma}\PY{o}{=}\PY{n}{my\PYZus{}sigma\PYZus{}e}\PY{p}{)}
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}232}]:} \PY{o}{\PYZpc{}}\PY{k}{run} my\PYZus{}pyfolio.py  \PYZsh{} needed to run functions below
\end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}350}]:} \PY{c}{\PYZsh{} ====== PLOT THE P\PYZam{}L CURVE FOR IN\PYZhy{}SAMPLE AND OUT\PYZhy{}OF\PYZhy{}SAMPLE ======}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
          
          \PY{n}{df}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{shift}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{grey}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}  \PY{c}{\PYZsh{} market benchmark for gasoil (long gasoil)}
          \PY{n}{df}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{brent}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{shift}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{grey}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}  \PY{c}{\PYZsh{} market benchmark for brent (long brent)}
          
          \PY{n}{k} \PY{o}{=} \PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}  \PY{c}{\PYZsh{} last non\PYZhy{}nan row of in\PYZhy{}sample pnl}
          \PY{n}{plot\PYZus{}drawdown\PYZus{}periods}\PY{p}{(}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{top}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}
          \PY{n}{plot\PYZus{}drawdown\PYZus{}periods}\PY{p}{(}\PY{n}{df\PYZus{}pnl\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{k}\PY{o}{=}\PY{n}{k}\PY{p}{,} \PY{n}{top}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{n}{sns}\PY{o}{.}\PY{n}{xkcd\PYZus{}rgb}\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{pale red}\PY{l+s}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
          
          \PY{c}{\PYZsh{} PnL using AR(1) bounds}
          \PY{n}{ar1\PYZus{}df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{sns}\PY{o}{.}\PY{n}{xkcd\PYZus{}rgb}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{denim blue}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{p}{(}\PY{n}{ar1\PYZus{}df\PYZus{}pnl\PYZus{}os}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]} \PY{o}{+} \PY{n}{ar1\PYZus{}df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl\PYZus{}cum}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{n}{sns}\PY{o}{.}\PY{n}{xkcd\PYZus{}rgb}\PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{pale red}\PY{l+s}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          
          \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{gasoil benchmark}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{brent benchmark}\PY{l+s}{\PYZsq{}}\PY{p}{,} 
                      \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(3) in\PYZhy{}sample}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(3) out\PYZhy{}of\PYZhy{}sample}\PY{l+s}{\PYZsq{}}\PY{p}{,}
                     \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(1) in\PYZhy{}sample}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{l+s}{\PYZsq{}}\PY{l+s}{AR(1) out\PYZhy{}of\PYZhy{}sample}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{,} 
                     \PY{n}{loc}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{upper left}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{large}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{ncol}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axvline}\PY{p}{(}\PY{n}{df\PYZus{}temp}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{black}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{:}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{black}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s}{\PYZsq{}}\PY{l+s}{P\PYZam{}L for two pair trading strategies and market benchmarks }\PY{l+s+se}{\PYZbs{}n}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{xx\PYZhy{}large}\PY{l+s}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{df\PYZus{}pnl\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{pnl}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{(top 5 drawdown periods shown for AR(3))}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{large}\PY{l+s}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}350}]:} <matplotlib.text.Text at 0x2abcf240>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_97_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Although earlier the Gasoil-Brent spread passed the Anderson-Darling
test for normality, we also saw it had memory AR(3) and this is expected
to interfere with the OU fit which is for AR(1) spreads. Hence, we are
motivated to search for alternative bounds to \(\mu_e \pm \sigma_{eq}\)
that could yield a higher PnL. One approach is through `brute
optimisation' as described below.

    \subsubsection{Bounds from Optimisation}\label{bounds-from-optimisation}

    \section{APPENDIX}\label{appendix}

    \section{Multivariate Regression}\label{multivariate-regression}

Also known as `generalised linear model', it generalises linear
regression to multiple input variables (regressors) and \(n\)
observations. It is best expressed in matrix form as:

\[
Y = X \beta + \epsilon
\]

where \(Y\) is a vector representing the endogenous (dependent)
variable, \(X\) is a matrix representing the exogenous (independent)
variables, \(\beta\) is the coefficients vector and \(\epsilon\) the
residuals vector.

The OLS method, which minimizes the sum of squared residuals via the
Maximum Likelihood Estimation method (MLE), is used to estimate the
parameters:

\[
\begin{align}
\hat{\beta} = (X^\prime X)^{-1} X^\prime Y \\
\hat{\epsilon} = Y - X \hat{\beta}
\end{align}
\]

The covariance matrix of the residuals estimate is:

\[
\hat{\Sigma} = scale \times  \sum \epsilon \epsilon^\prime
\] where \(scale = 1/ n\) using the MLE estimator or
\(scale= 1/ (n - kp)\) using the OLS estimator for a model with \(k\)
variables and \(p\) lags.

The covariance matrix for the coefficients is:

\[
(X X^\prime)^{-1} \otimes \hat{\Sigma}
\] where \(\otimes\) is the \emph{Kronecker product}.

The Log Likelihood Function for OLS is:

\[
\log(L) = -\frac{n}{2}\log (2 \pi) -\frac{n}{2}\log | \hat{\Sigma}| - \frac{n}{2}
\]

The variance of the residuals and parameters are therefore the diagonal
elements of the corresponding covariance matrices, from which the
standard errors can be calculated.

These are the conventions used in the script \emph{analysis.py}.
Additional mathematical details can be found in
\href{https://en.wikipedia.org/wiki/Vector_autoregression}{wiki VAR}.

The are several assumptions about the nature of the variables in the
model to hold. In particular, these should be \emph{stationary} and the
\(\epsilon\) homoscedastic (with finite variance) and normally
distributed.

The main applications of the multivariate regression are: * Vector
Autoregression Models - also known as VAR(p), these can be used to
forecast, test for stationarity (e.g.~ADF test) or model stationary
series like returns * Error Correction Model - also known as ECM, these
are used to model series which aren't stationary or that have stochastic
trends, like prices

    \subsection{Autoregression Models -
AR(p)}\label{autoregression-models---arp}

Also referred to as VAR(p) where \emph{p} is the lag order, the is
simply a linear regression on a time series and its lagged (past)
values:

\[
\begin{align}
Y_t = c + \sum^{p}_{i=1} \phi_i Y_{t-i} + \epsilon_t \\
\end{align}
\]

where c is a constant (also known as the drift term), \(\phi_i\) are the
parameters of the model and \(\epsilon_t\) is the error term. Whether to
exclude the constant \(c\) or not depends on the nature of what we are
trying to model.

Computationally, the model can be fitted in one go by using the OLS
method described above with a special matrix formulation. Example code
for this can be found in \emph{analysis.py} in the project repository.

As shown in Section X, the VAR(p) system can be rewritten in terms of
differences and lagged differeces, which is how it is commonly expressed
in some cases, for example in the ADF test. See more details in
\href{https://en.wikipedia.org/wiki/Vector_autoregression}{wiki VAR},
\href{https://en.wikipedia.org/wiki/Autoregressive_model}{wiki AR}

    \subsubsection{Dickey-Fuller Test and
ADF}\label{dickey-fuller-test-and-adf}

The \emph{Dickey-Fuller test} tests the null hypothesis of whether a
unit root is present in the autoregressive model (also known as AR(p),
see Appendix) of the time series. For example, a simple AR(1) model is:

\[
Y_t = \beta Y_{t-1} + \epsilon_t
\]

If \(\beta=1\) the series is said to have a `unit root' and is hence
non-stationary. The equation can be rewriten as:

\[
\Delta Y_t = (\beta - 1) Y_{t-1} + \epsilon_t = \phi Y_{t-1} + \epsilon_t
\]

where \(\phi= \beta-1\). Hence, testing for unit root is equivalent to
testing \(\phi=0\).

The value of the test statistic \(\hat{\phi}/std.err(\hat{\phi})\) is
then compared to the relevant critical values for the Dickey-Fuller
distribution. If found lower, then the null hypothesis \(\phi=0\) is
rejected and the series can be considered stationary.

There are 3 main versions of the test depending on whether drift and/or
time-dependent terms are included:

\begin{itemize}
\tightlist
\item
  Test for a unit root: \(\Delta Y_t = \phi Y_{t-1} + \epsilon_t\)
\item
  Test for a unit root with drift:
  \(\Delta Y_t = c_0 + \phi Y_{t-1} + \epsilon_t\)
\item
  Test for a unit root with drift and deterministic time trend:
  \(\Delta Y_t = c_0 + c_1 t + \phi Y_{t-1} + \epsilon_t\)
\end{itemize}

Each version of the test has its own critical values which depends on
the size of the sample. Which version to use isn't straightforward and
the wrong choice can lead to wrong conclusions. In general, financial
time series exclude the time trend.

There is an extension to the test called the \textbf{Augmented
Dickey--Fuller test (ADF)}, which removes autocorrelation effects by
including lagged difference terms \(\phi_p \Delta Y_{t-p}\). The optimal
lag oder could then be determined from the information criteria (see
above).

Clearly the above equations belong to the family of generalised linear
models, which means the parameters can be estimated using the familiar
linear regression described above.

Additional details on this topic can be found in
\href{https://en.wikipedia.org/wiki/Augmented_Dickey\%E2\%80\%93Fuller_test}{wiki
ADF},
\href{https://en.wikipedia.org/wiki/Dickey\%E2\%80\%93Fuller_test}{wiki
DF} and the Appendix.

    \subsubsection{Optimal Lag Order}\label{optimal-lag-order}

To select the optimal lag order, one approach uses the Akaike
Information Criterion (AIC). Iterating over different lag orders, the
one yielding the lowest value of AIC is selected. Statsmodels suggest to
try up to a maximum lag order of \(12*(n/100)^{1/4}\) where \(n\) is the
number of observations.

There are different definitions of AIC used - we use the same as in
\href{http://statsmodels.sourceforge.net/stable/vector_ar.html\#lag-order-selection}{statstools},
which has different definitions for AR(p) and ADF test as:

\[
\begin{equation}
AIC = \log | \hat{\Sigma} |+ 2 \frac{1 + k}{n} \qquad \mathrm{(AR(p) \ model)} \\
AIC = -2 \log(L) + 2k  \qquad \mathrm{(ADF \ test)} 
\end{equation}
\]

where \(k\) is the number of estimated parameters. Other information
criteria can be used, see for example
\href{https://en.wikipedia.org/wiki/Information_criterion}{ref}.

    \subsubsection{Stability Condition}\label{stability-condition}

It requires for the eigenvalues of the estimated coefficients matrix or
vector to be inside the unit circle (\$ \textless{} 1\$): \[
| \lambda I - \hat{\beta} | = 0
\] This is equivalent to requiring the roots of the characteristic
polynomial of the AR(p) system to be outside the unit circle - see
\href{http://matthieustigler.github.io/Lectures/Lect2ARMA.pdf}{ref}.

    \section{Cointegration between Italian and Dutch
Gas}\label{cointegration-between-italian-and-dutch-gas}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}233}]:} \PY{n}{df\PYZus{}gas} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}excel}\PY{p}{(}\PY{l+s}{\PYZdq{}}\PY{l+s}{data/PSV\PYZus{}TTF.xlsx}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{sheetname}\PY{o}{=}\PY{l+s}{\PYZdq{}}\PY{l+s}{Sheet1}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{dayfirst}\PY{o}{=}\PY{n+nb+bp}{True}\PY{p}{)}
          \PY{n}{df\PYZus{}gas}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s}{\PYZdq{}}\PY{l+s}{PSV}\PY{l+s}{\PYZdq{}}\PY{p}{,} \PY{l+s}{\PYZdq{}}\PY{l+s}{TTF}\PY{l+s}{\PYZdq{}}\PY{p}{]}
          \PY{n}{df\PYZus{}gas} \PY{o}{=} \PY{n}{df\PYZus{}gas}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} remove missing values}
          \PY{n}{df\PYZus{}gas\PYZus{}is} \PY{o}{=} \PY{n}{df\PYZus{}gas}\PY{p}{[}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2015}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:} \PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2015}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{31}\PY{p}{)}\PY{p}{]} 
          \PY{n}{df\PYZus{}gas\PYZus{}is}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}233}]:} <matplotlib.axes.\_subplots.AxesSubplot at 0x1aa992e8>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_107_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{c}{\PYZsh{} ======  ENGLE\PYZhy{}GRANGER 2\PYZhy{}STEP METHOD  ======}
         
         \PY{c}{\PYZsh{} ===== STEP 1: GET SPREAD FROM OLS =====}
         
         \PY{c}{\PYZsh{} My OLS and ADF implementatin}
         \PY{k+kn}{from} \PY{n+nn}{analysis} \PY{k+kn}{import} \PY{n}{my\PYZus{}OLS}
         
         \PY{c}{\PYZsh{} Import statsmodels equivalents to validate results}
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.tsa.tsatools} \PY{k+kn}{import} \PY{n}{add\PYZus{}constant}
         \PY{k+kn}{from} \PY{n+nn}{statsmodels.regression.linear\PYZus{}model} \PY{k+kn}{import} \PY{n}{OLS}
         
         \PY{c}{\PYZsh{} Define variables}
         \PY{n}{x} \PY{o}{=} \PY{n}{df\PYZus{}gas\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{TTF}\PY{l+s}{\PYZsq{}}\PY{p}{]}  \PY{c}{\PYZsh{} explanatory variable (\PYZsq{}X\PYZsq{})}
         \PY{n}{y} \PY{o}{=} \PY{n}{df\PYZus{}gas\PYZus{}is}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{PSV}\PY{l+s}{\PYZsq{}}\PY{p}{]}   \PY{c}{\PYZsh{} dependent variable (\PYZsq{}Y\PYZsq{})}
         \PY{c}{\PYZsh{} x = df\PYZus{}is[\PYZsq{}brent\PYZsq{}].diff().dropna()  \PYZsh{} explanatory variable (\PYZsq{}X\PYZsq{})}
         \PY{c}{\PYZsh{} y = df\PYZus{}is[\PYZsq{}gasoil\PYZsq{}].diff().dropna()   \PYZsh{} dependent variable (\PYZsq{}Y\PYZsq{})}
         
         \PY{c}{\PYZsh{} Do OLS}
         \PY{n}{x} \PY{o}{=} \PY{n}{add\PYZus{}constant}\PY{p}{(}\PY{n}{x}\PY{p}{)}
         \PY{n}{my\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{my\PYZus{}OLS}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{x}\PY{p}{)}
         \PY{n}{sm\PYZus{}res\PYZus{}ols} \PY{o}{=} \PY{n}{OLS}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{x}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}  \PY{c}{\PYZsh{} validate result with statsmodels}
         \PY{n}{x} \PY{o}{=} \PY{n}{x}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}  \PY{c}{\PYZsh{} remove the constant now that we\PYZsq{}re done}
         
         \PY{c}{\PYZsh{} Set values of estimated parameters}
         \PY{n}{c\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{beta2\PYZus{}hat} \PY{o}{=} \PY{n}{my\PYZus{}res\PYZus{}ols}\PY{p}{[}\PY{l+s}{\PYZsq{}}\PY{l+s}{params}\PY{l+s}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
         \PY{c}{\PYZsh{} cointegration spread, should be == sm\PYZus{}res\PYZus{}ols.resid ==  my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}]}
         \PY{n}{e\PYZus{}t\PYZus{}hat} \PY{o}{=} \PY{n}{y} \PY{o}{\PYZhy{}} \PY{n}{c\PYZus{}hat} \PY{o}{\PYZhy{}} \PY{n}{beta2\PYZus{}hat}\PY{o}{*}\PY{n}{x}
         \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s}{\PYZsq{}}\PY{l+s}{e\PYZus{}t\PYZus{}hat}\PY{l+s}{\PYZsq{}}
         
         \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}params\PYZsq{}]}
         \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.params}
         \PY{c}{\PYZsh{} print e\PYZus{}t\PYZus{}hat.mean()}
         \PY{n}{sm\PYZus{}res\PYZus{}ols}\PY{o}{.}\PY{n}{summary2}\PY{p}{(}\PY{p}{)}
         \PY{c}{\PYZsh{} print my\PYZus{}res\PYZus{}ols[\PYZsq{}resid\PYZus{}hat\PYZsq{}].head()}
         \PY{c}{\PYZsh{} print sm\PYZus{}res\PYZus{}ols.resid.head()}
         \PY{c}{\PYZsh{} print e\PYZus{}t\PYZus{}hat.head()}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}12}]:} <class 'statsmodels.iolib.summary2.Summary'>
         """
                           Results: Ordinary least squares
         ==================================================================
         Model:              OLS              Adj. R-squared:     0.960    
         Dependent Variable: PSV              AIC:                270.4483 
         Date:               2016-07-22 10:10 BIC:                277.5151 
         No. Observations:   253              Log-Likelihood:     -133.22  
         Df Model:           1                F-statistic:        5995.    
         Df Residuals:       251              Prob (F-statistic): 3.35e-177
         R-squared:          0.960            Scale:              0.16918  
         ---------------------------------------------------------------------
                   Coef.     Std.Err.       t       P>|t|     [0.025    0.975]
         ---------------------------------------------------------------------
         const     2.4463      0.2501     9.7813    0.0000    1.9538    2.9389
         TTF       0.9635      0.0124    77.4246    0.0000    0.9390    0.9880
         ------------------------------------------------------------------
         Omnibus:               20.913       Durbin-Watson:          0.239 
         Prob(Omnibus):         0.000        Jarque-Bera (JB):       73.449
         Skew:                  -0.129       Prob(JB):               0.000 
         Kurtosis:              5.627        Condition No.:          195   
         ==================================================================
         
         """
\end{Verbatim}
        
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{red}\PY{l+s}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s}{\PYZsq{}}\PY{l+s}{\PYZhy{}\PYZhy{}}\PY{l+s}{\PYZsq{}}\PY{p}{)} \PY{c}{\PYZsh{} Add the mean}
\end{Verbatim}

            \begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}16}]:} <matplotlib.lines.Line2D at 0xbea8c88>
\end{Verbatim}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_109_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{k+kn}{from} \PY{n+nn}{statsmodels.graphics.tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}pacf}
         \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{plot\PYZus{}pacf}\PY{p}{(}\PY{n}{e\PYZus{}t\PYZus{}hat}\PY{p}{,} \PY{n}{lags}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.01}\PY{p}{)}
\end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Coint_Brent_Gasoil_v2_files/Coint_Brent_Gasoil_v2_110_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    

    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
